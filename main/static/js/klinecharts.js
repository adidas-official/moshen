/**
 * @license
 * KLineChart v8.0.0
 * Copyright (c) 2019 lihu.
 * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).klinecharts={})}(this,(function(t){"use strict";var e={name:"BBI",series:"price",precision:2,calcParams:[3,6,12,24],shouldCheckParamCount:!0,shouldOhlc:!0,plots:[{key:"bbi",title:"BBI: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a=e.params,i=Math.max.apply(null,a),n=[],r=[];return t.map((function(e,s){var o={},c=e.close;if(a.forEach((function(e,a){n[a]=(n[a]||0)+c,e-1>s||(r[a]=n[a]/e,n[a]-=t[s-(e-1)].close)})),s>=i-1){var h=0;r.forEach((function(t){h+=t})),o.bbi=h/4}return o}))}},a={name:"DMA",calcParams:[10,50,10],plots:[{key:"dma",title:"DMA: ",type:"line"},{key:"ama",title:"AMA: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a=e.params,i=Math.max(a[0],a[1]),n=0,r=0,s=0,o=[];return t.forEach((function(e,c){var h,l,u={},d=e.close;if(n+=d,r+=d,a[0]-1>c||(h=n/a[0],n-=t[c-(a[0]-1)].close),a[1]-1>c||(l=r/a[1],r-=t[c-(a[1]-1)].close),c>=i-1){var v=h-l;u.dma=v,s+=v,i+a[2]-2>c||(u.ama=s/a[2],s-=o[c-(a[2]-1)].dma)}o.push(u)})),o}},i={name:"DMI",calcParams:[14,6],plots:[{key:"pdi",title:"PDI: ",type:"line"},{key:"mdi",title:"MDI: ",type:"line"},{key:"adx",title:"ADX: ",type:"line"},{key:"adxr",title:"ADXR: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a=e.params,i=0,n=0,r=0,s=0,o=0,c=0,h=0,l=0,u=[];return t.forEach((function(e,d){var v={},_=t[d-1]||e,f=_.close,p=e.high,m=e.low,y=p-m,x=Math.abs(p-f),g=Math.abs(f-m),k=p-_.high,S=_.low-m,D=Math.max(Math.max(y,x),g),w=k>0&&k>S?k:0,b=S>0&&S>k?S:0;if(i+=D,n+=w,r+=b,d>=a[0]-1){d>a[0]-1?(s=s-s/a[0]+D,o=o-o/a[0]+w,c=c-c/a[0]+b):(s=i,o=n,c=r);var E=0,C=0;0!==s&&(E=100*o/s,C=100*c/s),v.pdi=E,v.mdi=C;var P=0;C+E!==0&&(P=Math.abs(C-E)/(C+E)*100),h+=P,2*a[0]-2>d||(v.adx=l=d>2*a[0]-2?(l*(a[0]-1)+P)/a[0]:h/a[0],2*a[0]+a[1]-3>d||(v.adxr=(u[d-(a[1]-1)].adx+l)/2))}u.push(v)})),u}},n={name:"MACD",calcParams:[12,26,9],plots:[{key:"dif",title:"DIF: ",type:"line"},{key:"dea",title:"DEA: ",type:"line"},{key:"macd",title:"MACD: ",type:"bar",baseValue:0,color:function(t,e){var a=(t.current.technicalIndicatorData||{}).macd;return a>0?e.bar.upColor:0>a?e.bar.downColor:e.bar.noChangeColor},isStroke:function(t){return(t.current.technicalIndicatorData||{}).macd>(t.prev.technicalIndicatorData||{}).macd}}],calcTechnicalIndicator:function(t,e){var a,i,n=e.params,r=0,s=0,o=0,c=0,h=Math.max(n[0],n[1]);return t.map((function(t,e){var l={},u=t.close;return r+=u,n[0]-1>e||(a=e>n[0]-1?(2*u+(n[0]-1)*a)/(n[0]+1):r/n[0]),n[1]-1>e||(i=e>n[1]-1?(2*u+(n[1]-1)*i)/(n[1]+1):r/n[1]),h-1>e||(l.dif=s=a-i,o+=s,h+n[2]-2>e||(l.macd=2*(s-(c=e>h+n[2]-2?(2*s+c*(n[2]-1))/(n[2]+1):o/n[2])),l.dea=c)),l}))}},r={name:"CR",calcParams:[26,10,20,40,60],plots:[{key:"cr",title:"CR: ",type:"line"},{key:"ma1",title:"MA1: ",type:"line"},{key:"ma2",title:"MA2: ",type:"line"},{key:"ma3",title:"MA3: ",type:"line"},{key:"ma4",title:"MA4: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a=e.params,i=Math.ceil(a[1]/2.5+1),n=Math.ceil(a[2]/2.5+1),r=Math.ceil(a[3]/2.5+1),s=Math.ceil(a[4]/2.5+1),o=0,c=[],h=0,l=[],u=0,d=[],v=0,_=[],f=[];return t.forEach((function(e,p){var m={},y=t[p-1]||e,x=(y.high+y.close+y.low+y.open)/4,g=Math.max(0,e.high-x),k=Math.max(0,x-e.low);a[0]-1>p||(m.cr=0!==k?g/k*100:0,o+=m.cr,h+=m.cr,u+=m.cr,v+=m.cr,a[0]+a[1]-2>p||(c.push(o/a[1]),a[0]+a[1]+i-3>p||(m.ma1=c[c.length-1-i]),o-=f[p-(a[1]-1)].cr),a[0]+a[2]-2>p||(l.push(h/a[2]),a[0]+a[2]+n-3>p||(m.ma2=l[l.length-1-n]),h-=f[p-(a[2]-1)].cr),a[0]+a[3]-2>p||(d.push(u/a[3]),a[0]+a[3]+r-3>p||(m.ma3=d[d.length-1-r]),u-=f[p-(a[3]-1)].cr),a[0]+a[4]-2>p||(_.push(v/a[4]),a[0]+a[4]+s-3>p||(m.ma4=_[_.length-1-s]),v-=f[p-(a[4]-1)].cr)),f.push(m)})),f}},s={name:"AO",calcParams:[5,34],shouldCheckParamCount:!0,plots:[{key:"ao",title:"AO: ",type:"bar",baseValue:0,color:function(t,e){return(t.current.technicalIndicatorData||{}).ao>(t.prev.technicalIndicatorData||{}).ao?e.bar.upColor:e.bar.downColor},isStroke:function(t){return(t.current.technicalIndicatorData||{}).ao>(t.prev.technicalIndicatorData||{}).ao}}],calcTechnicalIndicator:function(t,e){var a=e.params,i=Math.max(a[0],a[1]),n=0,r=0,s=0,o=0;return t.map((function(e,c){var h={},l=(e.low+e.high)/2;if(n+=l,r+=l,c>=a[0]-1){s=n/a[0];var u=t[c-(a[0]-1)];n-=(u.low+u.high)/2}if(c>=a[1]-1){o=r/a[1];var d=t[c-(a[1]-1)];r-=(d.low+d.high)/2}return i-1>c||(h.ao=s-o),h}))}},o={name:"CCI",calcParams:[20],plots:[{key:"cci",title:"CCI: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a=e.params,i=a[0]-1,n=0,r=[];return t.map((function(e,s){var o={},c=(e.high+e.low+e.close)/3;if(n+=c,r.push(c),s>=i){var h=n/a[0],l=r.slice(s-i,s+1),u=0;l.forEach((function(t){u+=Math.abs(t-h)}));var d=u/a[0];o.cci=0!==d?(c-h)/d/.015:0,n-=(t[s-i].high+t[s-i].low+t[s-i].close)/3}return o}))}},c={name:"RSI",calcParams:[6,12,24],shouldCheckParamCount:!1,plots:[{key:"rsi1",title:"RSI1: ",type:"line"},{key:"rsi2",title:"RSI2: ",type:"line"},{key:"rsi3",title:"RSI3: ",type:"line"}],regeneratePlots:function(t){return t.map((function(t,e){var a=e+1;return{key:"rsi".concat(a),title:"RSI".concat(a,": "),type:"line"}}))},calcTechnicalIndicator:function(t,e){var a=e.params,i=e.plots,n=[],r=[];return t.map((function(e,s){var o={},c=e.close-(t[s-1]||e).close;return a.forEach((function(e,a){if(c>0?n[a]=(n[a]||0)+c:r[a]=(r[a]||0)+Math.abs(c),s>=e-1){o[i[a].key]=0!==r[a]?100-100/(1+n[a]/r[a]):0;var h=t[s-(e-1)],l=h.close-(t[s-e]||h).close;l>0?n[a]-=l:r[a]-=Math.abs(l)}})),o}))}};function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=Number.MIN_SAFE_INTEGER,a=Number.MAX_SAFE_INTEGER;return t.forEach((function(t){e=Math.max(t.high,e),a=Math.min(t.low,a)})),{hn:e,ln:a}}var l={name:"KDJ",calcParams:[9,3,3],plots:[{key:"k",title:"K: ",type:"line"},{key:"d",title:"D: ",type:"line"},{key:"j",title:"J: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a=e.params,i=[];return t.forEach((function(e,n){var r={},s=e.close;if(n>=a[0]-1){var o=h(t.slice(n-(a[0]-1),n+1)),c=o.ln,l=o.hn-c;r.k=((a[1]-1)*(i[n-1].k||50)+(s-c)/(0===l?1:l)*100)/a[1],r.d=((a[2]-1)*(i[n-1].d||50)+r.k)/a[2],r.j=3*r.k-2*r.d}i.push(r)})),i}},u={name:"WR",calcParams:[6,10,14],shouldCheckParamCount:!1,plots:[{key:"wr1",title:"WR1: ",type:"line"},{key:"wr2",title:"WR2: ",type:"line"},{key:"wr3",title:"WR3: ",type:"line"}],regeneratePlots:function(t){return t.map((function(t,e){return{key:"wr".concat(e+1),title:"WR".concat(e+1,": "),type:"line"}}))},calcTechnicalIndicator:function(t,e){var a=e.params,i=e.plots;return t.map((function(e,n){var r={},s=e.close;return a.forEach((function(e,a){var o=e-1;if(n>=o){var c=h(t.slice(n-o,n+1)),l=c.hn,u=l-c.ln;r[i[a].key]=0===u?0:(s-l)/u*100}})),r}))}};var d={name:"BOLL",calcParams:[20,{value:2,allowDecimal:!0}],precision:2,shouldOhlc:!0,plots:[{key:"up",title:"UP: ",type:"line"},{key:"mid",title:"MID: ",type:"line"},{key:"dn",title:"DN: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a=e.params,i=a[0]-1,n=0;return t.map((function(e,r){var s={};if(n+=e.close,r>=i){s.mid=n/a[0];var o=function(t,e){var a=t.length,i=0;t.forEach((function(t){var a=t.close-e;i+=a*a}));var n=i>0,r=Math.sqrt((i=Math.abs(i))/a);return n?r:-1*r}(t.slice(r-i,r+1),s.mid);s.up=s.mid+a[1]*o,s.dn=s.mid-a[1]*o,n-=t[r-i].close}return s}))}},v={name:"SAR",series:"price",calcParams:[2,2,20],precision:2,shouldOhlc:!0,plots:[{key:"sar",title:"SAR: ",type:"circle",color:function(t,e){var a=t.current,i=a.kLineData||{};return(i.high+i.low)/2>(a.technicalIndicatorData||{}).sar?e.circle.upColor:e.circle.downColor}}],calcTechnicalIndicator:function(t,e){var a=e.params,i=a[0]/100,n=a[1]/100,r=a[2]/100,s=i,o=-100,c=!1,h=0;return t.map((function(e,a){var l=h,u=e.high,d=e.low;if(c){(-100===o||u>o)&&(o=u,s=Math.min(s+n,r)),h=l+s*(o-l);var v=Math.min(t[Math.max(1,a)-1].low,d);h>e.low?(h=o,s=i,o=-100,c=!c):h>v&&(h=v)}else{(-100===o||o>d)&&(o=d,s=Math.min(s+n,r)),h=l+s*(o-l);var _=Math.max(t[Math.max(1,a)-1].high,u);e.high>h?(h=o,s=0,o=-100,c=!c):_>h&&(h=_)}return{sar:h}}))}},_={technicalIndicatorExtensions:{},shapeExtensions:{},addTechnicalIndicatorTemplate:function(t){var e=this;t&&[].concat(t).forEach((function(t){t.name&&(e.technicalIndicatorExtensions[t.name]=t)}))},addShapeTemplate:function(t){var e=this;t&&[].concat(t).forEach((function(t){t.name&&(e.shapeExtensions[t.name]=t)}))}};function f(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function p(t){for(var e=1;arguments.length>e;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?f(Object(a),!0).forEach((function(e){k(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function y(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function x(t,e){for(var a=0;e.length>a;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function g(t,e,a){return e&&x(t.prototype,e),a&&x(t,a),t}function k(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function S(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&w(t,e)}function D(t){return D=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},D(t)}function w(t,e){return w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},w(t,e)}function b(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function E(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var a,i=D(t);if(e){var n=D(this).constructor;a=Reflect.construct(i,arguments,n)}else a=i.apply(this,arguments);return b(this,a)}}function C(t,e,a){return C="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,a){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=D(t)););return t}(t,e);if(i){var n=Object.getOwnPropertyDescriptor(i,e);return n.get?n.get.call(a):n.value}},C(t,e,a||t)}function P(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,i=Array(e);e>a;a++)i[a]=t[a];return i}function I(t,e){var a="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!a){if(Array.isArray(t)||(a=function(t,e){if(t){if("string"==typeof t)return P(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?P(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){a&&(t=a);var i=0,n=function(){};return{s:n,n:function(){return t.length>i?{done:!1,value:t[i++]}:{done:!0}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,s=!0,o=!1;return{s:function(){a=a.call(t)},n:function(){var t=a.next();return s=t.done,t},e:function(t){o=!0,r=t},f:function(){try{s||null==a.return||a.return()}finally{if(o)throw r}}}}function A(t,e){if(O(t)&&O(e))for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)&&a in t){var i=t[a],n=e[a];O(n)&&O(i)&&!M(n)&&!M(i)?A(i,n):F(e[a])&&(t[a]=e[a])}}function T(t){if(!O(t))return t;var e;for(var a in e=M(t)?[]:{},t)if(Object.prototype.hasOwnProperty.call(t,a)){var i=t[a];e[a]=O(i)?T(i):i}return e}function M(t){return"[object Array]"===Object.prototype.toString.call(t)}function L(t){return t&&"function"==typeof t}function O(t){return!!t&&"object"===m(t)}function R(t){return"number"==typeof t&&!isNaN(t)}function F(t){return null!=t}function z(t){return"boolean"==typeof t}function B(t){return"string"==typeof t}var V="stroke",H="fill",Y="dash",W="solid",N="left",j="right",X="normal",G="percentage",Z="log",U="candle_solid",K="candle_stroke",q="candle_up_stroke",$="candle_down_stroke",J="ohlc",Q="area",tt="always",et="follow_cross",at="rect",it="standard",nt="circle",rt="rect",st="triangle",ot="diamond",ct="custom",ht="point",lt="top",ut="bottom",dt={grid:{show:!0,horizontal:{show:!0,size:1,color:"#EDEDED",style:Y,dashValue:[2,2]},vertical:{show:!0,size:1,color:"#EDEDED",style:Y,dashValue:[2,2]}},candle:{margin:{top:.2,bottom:.1},type:U,bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#999999"},area:{lineSize:2,lineColor:"#2196F3",value:"close",backgroundColor:[{offset:0,color:"rgba(33, 150, 243, 0.01)"},{offset:1,color:"rgba(33, 150, 243, 0.2)"}]},priceMark:{show:!0,high:{show:!0,color:"#76808F",textMargin:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},low:{show:!0,color:"#76808F",textMargin:5,textSize:10,textFamily:"Helvetica Neue",textWeight:"normal"},last:{show:!0,upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#888888",line:{show:!0,style:Y,dashValue:[4,4],size:1},text:{show:!0,size:12,paddingLeft:2,paddingTop:2,paddingRight:2,paddingBottom:2,color:"#FFFFFF",family:"Helvetica Neue",weight:"normal",borderRadius:2}}},tooltip:{showRule:tt,showType:it,labels:["时间: ","开: ","收: ","高: ","低: ","成交量: "],values:null,defaultValue:"n/a",rect:{paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:6,offsetLeft:8,offsetTop:8,offsetRight:8,borderRadius:4,borderSize:1,borderColor:"#F2F3F5",backgroundColor:"#FEFEFE"},text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginLeft:8,marginTop:6,marginRight:8,marginBottom:0}}},technicalIndicator:{margin:{top:.2,bottom:.1},bar:{upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"},line:{size:1,colors:["#FF9600","#9D65C9","#2196F3","#E11D74","#01C5C4"]},circle:{upColor:"rgba(38, 166, 154, .65)",downColor:"rgba(239, 83, 80, .65)",noChangeColor:"#888888"},lastValueMark:{show:!1,text:{show:!1,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:3,paddingTop:2,paddingRight:3,paddingBottom:2,borderRadius:2}},tooltip:{showRule:tt,showType:it,showName:!0,showParams:!0,defaultValue:"n/a",text:{size:12,family:"Helvetica Neue",weight:"normal",color:"#76808F",marginTop:6,marginRight:8,marginBottom:0,marginLeft:8}}},xAxis:{show:!0,height:null,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",paddingTop:3,paddingBottom:6},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},yAxis:{show:!0,width:null,type:X,position:j,inside:!1,axisLine:{show:!0,color:"#DDDDDD",size:1},tickText:{show:!0,color:"#76808F",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:3,paddingRight:6},tickLine:{show:!0,size:1,length:3,color:"#DDDDDD"}},separator:{size:1,color:"#DDDDDD",fill:!0,activeBackgroundColor:"rgba(33, 150, 243, 0.08)"},crosshair:{show:!0,horizontal:{show:!0,line:{show:!0,style:Y,dashValue:[4,2],size:1,color:"#76808F"},text:{show:!0,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#686D76",borderRadius:2,backgroundColor:"#686D76"}},vertical:{show:!0,line:{show:!0,style:Y,dashValue:[4,2],size:1,color:"#76808F"},text:{show:!0,color:"#FFFFFF",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderRadius:2,borderColor:"#686D76",backgroundColor:"#686D76"}}},shape:{point:{backgroundColor:"#2196F3",borderColor:"rgba(33, 150, 243, 0.35)",borderSize:1,radius:5,activeBackgroundColor:"#2196F3",activeBorderColor:"rgba(33, 150, 243, 0.35)",activeBorderSize:3,activeRadius:5},line:{style:W,color:"#2196F3",size:1,dashValue:[2,2]},polygon:{style:V,stroke:{style:W,size:1,color:"#2196F3",dashValue:[2,2]},fill:{color:"#2196F3"}},arc:{style:V,stroke:{style:W,size:1,color:"#2196F3",dashValue:[2,2]},fill:{color:"#2196F3"}},text:{style:H,color:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",offset:[0,0]}},annotation:{position:lt,offset:[20,0],symbol:{type:ot,size:8,color:"#2196F3",activeSize:10,activeColor:"#FF9600"}},tag:{position:ht,offset:0,line:{show:!0,style:Y,dashValue:[4,2],size:1,color:"#2196F3"},text:{color:"#FFFFFF",backgroundColor:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderRadius:2},mark:{color:"#FFFFFF",backgroundColor:"#2196F3",size:12,family:"Helvetica Neue",weight:"normal",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderRadius:2}}};function vt(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"--";if(O(t)){var i=t[e];if(F(i))return i}return a}function _t(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"MM-DD hh:mm";if(R(e)){var i=t.format(new Date(e)),n=i.split(", "),r=n[0].split("/"),s={YYYY:r[2],MM:r[0],DD:r[1],"hh:mm":"24"===n[1].match(/^[\d]{2}/)[0]?n[1].replace(/^[\d]{2}/,"00"):n[1]};return a.replace(/YYYY|MM|DD|(hh:mm)/g,(function(t){return s[t]}))}return"--"}function ft(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,a=+t;return(a||0===a)&&R(a)?a.toFixed(e):"".concat(a)}function pt(t){return R(+t)?t>1e9?"".concat(+(t/1e9).toFixed(3),"B"):t>1e6?"".concat(+(t/1e6).toFixed(3),"M"):t>1e3?"".concat(+(t/1e3).toFixed(3),"K"):t:"--"}function mt(t,e){return null==e&&(e=10),+(t=(+t).toFixed(e=Math.min(Math.max(0,e),20)))}function yt(t){return Math.log(t)/Math.log(10)}function xt(t){return Math.pow(10,t)}var gt="technical_indicator_pane_",kt="candle_pane",St=1,Dt=2,wt=3,bt={ZOOM:"zoom",SCROLL:"scroll",CROSSHAIR:"crosshair",PANE_DRAG:"pane_drag"},Et=function(){function t(e){y(this,t),this._chartData=e,this._dateTimeFormat=new Intl.DateTimeFormat("en",{hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}),this._zoomEnabled=!0,this._scrollEnabled=!0,this._loading=!0,this._loadMoreCallback=null,this._more=!0,this._totalDataSpace=0,this._dataSpace=6,this._barSpace=this._calcBarSpace(),this._offsetRightSpace=50,this._offsetRightBarCount=this._offsetRightSpace/this._dataSpace,this._leftMinVisibleBarCount=2,this._rightMinVisibleBarCount=2,this._from=0,this._to=0,this._preOffsetRightBarCount=0}return g(t,[{key:"_calcBarSpace",value:function(){return Math.max(1,Math.min(Math.floor(.82*this._dataSpace),Math.floor(this._dataSpace)-1))}},{key:"adjustFromTo",value:function(){var t=this._chartData.dataList().length,e=this._totalDataSpace/this._dataSpace,a=e-Math.min(this._leftMinVisibleBarCount,t);this._offsetRightBarCount>a&&(this._offsetRightBarCount=a);var i=-t+Math.min(this._rightMinVisibleBarCount,t);i>this._offsetRightBarCount&&(this._offsetRightBarCount=i),this._to=Math.round(this._offsetRightBarCount+t+.5),this._from=Math.round(this._to-e)-1,this._to>t&&(this._to=t),0>this._from&&(this._from=0),this._chartData.adjustVisibleDataList(),0===this._from&&this._more&&!this._loading&&L(this._loadMoreCallback)&&(this._loading=!0,this._loadMoreCallback(vt(this._chartData.dataList()[0],"timestamp")))}},{key:"setMore",value:function(t){this._more=t}},{key:"setLoading",value:function(t){this._loading=t}},{key:"dateTimeFormat",value:function(){return this._dateTimeFormat}},{key:"setTimezone",value:function(t){var e;try{e=new Intl.DateTimeFormat("en",{hour12:!1,timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(t){}e&&(this._dateTimeFormat=e)}},{key:"timezone",value:function(){return this._dateTimeFormat.resolvedOptions().timeZone}},{key:"dataSpace",value:function(){return this._dataSpace}},{key:"barSpace",value:function(){return this._barSpace}},{key:"halfBarSpace",value:function(){return this._barSpace/2}},{key:"setDataSpace",value:function(t,e){1>t||t>50||this._dataSpace===t||(this._dataSpace=t,this._barSpace=this._calcBarSpace(),e&&e(),this.adjustFromTo(),this._chartData.crosshairStore().recalculate(!0),this._chartData.invalidate())}},{key:"setTotalDataSpace",value:function(t){this._totalDataSpace!==t&&(this._totalDataSpace=t,this.adjustFromTo(),this._chartData.crosshairStore().recalculate(!0))}},{key:"setOffsetRightSpace",value:function(t,e){this._offsetRightSpace=t,this._offsetRightBarCount=t/this._dataSpace,e&&(this.adjustFromTo(),this._chartData.crosshairStore().recalculate(!0),this._chartData.invalidate())}},{key:"resetOffsetRightSpace",value:function(){this.setOffsetRightSpace(this._offsetRightSpace)}},{key:"offsetRightSpace",value:function(){return this._offsetRightSpace}},{key:"offsetRightBarCount",value:function(){return this._offsetRightBarCount}},{key:"setOffsetRightBarCount",value:function(t){this._offsetRightBarCount=t}},{key:"setLeftMinVisibleBarCount",value:function(t){this._leftMinVisibleBarCount=t}},{key:"setRightMinVisibleBarCount",value:function(t){this._rightMinVisibleBarCount=t}},{key:"from",value:function(){return this._from}},{key:"to",value:function(){return this._to}},{key:"startScroll",value:function(){this._preOffsetRightBarCount=this._offsetRightBarCount}},{key:"scroll",value:function(t,e){if(this._scrollEnabled){var a=t/this._dataSpace;this._chartData.actionStore().execute(bt.SCROLL,{barCount:a,distance:t}),this._offsetRightBarCount=this._preOffsetRightBarCount-a,this.adjustFromTo();var i=e||this._chartData.crosshairStore().get();this._chartData.crosshairStore().set(i,!0),this._chartData.invalidate()}}},{key:"getDataByDataIndex",value:function(t){return this._chartData.dataList()[t]}},{key:"coordinateToFloatIndex",value:function(t){var e=this._chartData.dataList().length;return Math.round(1e6*(e+this._offsetRightBarCount-(this._totalDataSpace-t)/this._dataSpace))/1e6}},{key:"dataIndexToTimestamp",value:function(t){var e=this.getDataByDataIndex(t);if(e)return e.timestamp}},{key:"timestampToDataIndex",value:function(t){return 0===this._chartData.dataList().length?0:function(t,e,a){var i=0,n=0;for(n=t.length-1;i!==n;){var r=Math.floor((n+i)/2),s=n-i,o=t[r][e];if(a===t[i][e])return i;if(a===t[n][e])return n;if(a===o)return r;if(a>o?i=r:n=r,2>=s)break}return i}(this._chartData.dataList(),"timestamp",t)}},{key:"dataIndexToCoordinate",value:function(t){var e=this._chartData.dataList().length;return this._totalDataSpace-(e+this._offsetRightBarCount-t-.5)*this._dataSpace}},{key:"coordinateToDataIndex",value:function(t){return Math.ceil(this.coordinateToFloatIndex(t))-1}},{key:"zoom",value:function(t,e){var a=this;if(this._zoomEnabled){if(!e||!F(e.x)){var i=this._chartData.crosshairStore().get();e={x:F(i.x)?i.x:this._totalDataSpace/2}}this._chartData.actionStore().execute(bt.ZOOM,{coordinate:e,scale:t});var n=this.coordinateToFloatIndex(e.x);this.setDataSpace(this._dataSpace+t*(this._dataSpace/10),(function(){a._offsetRightBarCount+=n-a.coordinateToFloatIndex(e.x)}))}}},{key:"setZoomEnabled",value:function(t){this._zoomEnabled=t}},{key:"zoomEnabled",value:function(){return this._zoomEnabled}},{key:"setScrollEnabled",value:function(t){this._scrollEnabled=t}},{key:"scrollEnabled",value:function(){return this._scrollEnabled}},{key:"setLoadMoreCallback",value:function(t){this._loadMoreCallback=t}},{key:"clear",value:function(){this._more=!0,this._loading=!0,this._from=0,this._to=0}}]),t}(),Ct="line",Pt="bar",It="circle",At={PRICE:"price",VOLUME:"volume",NORMAL:"normal"},Tt=function(){function t(e){var a=e.name,i=e.series,n=e.calcParams,r=e.plots,s=e.precision,o=e.shouldCheckParamCount,c=e.shouldOhlc,h=e.shouldFormatBigNumber,l=e.minValue,u=e.maxValue,d=e.styles;y(this,t),this.name=a||"",this.series=-1!==Object.values(At).indexOf(i)?i:At.NORMAL,this.precision=R(s)&&s>=0?s:4,this._precisionFlag=!1,this.calcParams=M(n)?n:[],this.plots=M(r)?r:[],this.shouldCheckParamCount=!z(o)||o,this.shouldOhlc=!!z(c)&&c,this.shouldFormatBigNumber=!!z(h)&&h,this.minValue=l,this.maxValue=u,this.styles=d,this.result=[]}return g(t,[{key:"_createParams",value:function(t){return t.map((function(t){return O(t)?t.value:t}))}},{key:"setPrecision",value:function(t,e){return!(!R(t)||0>t||e&&(!e||this._precisionFlag))&&(this.precision=parseInt(t,10),e||(this._precisionFlag=!0),!0)}},{key:"setCalcParams",value:function(t){if(!M(t))return!1;if(this.shouldCheckParamCount&&t.length!==this.calcParams.length)return!1;for(var e=[],a=0;t.length>a;a++){var i=t[a],n=void 0,r=void 0;O(i)?(n=i.value,r=i.allowDecimal):(n=i,r=!1);var s=this.calcParams[a];if(O(s)&&z(s.allowDecimal)&&(r=s.allowDecimal),!R(n)||0>=n||!r&&parseInt(n,10)!==n)return!1;e.push({allowDecimal:r,value:n})}this.calcParams=e;var o=this.regeneratePlots(this._createParams(e));return o&&M(o)&&(this.plots=o),!0}},{key:"setShouldOhlc",value:function(t){return!(!z(t)||this.shouldOhlc===t)&&(this.shouldOhlc=t,!0)}},{key:"setShouldFormatBigNumber",value:function(t){return!(!z(t)||this.shouldFormatBigNumber===t)&&(this.shouldFormatBigNumber=t,!0)}},{key:"setStyles",value:function(t,e){return!!O(t)&&(this.styles||(this.styles={bar:T(e.bar),line:T(e.line),circle:T(e.circle)}),A(this.styles,t),!0)}},{key:"calc",value:function(t){this.result=this.calcTechnicalIndicator(t,{params:this._createParams(this.calcParams),plots:this.plots})||[]}},{key:"calcTechnicalIndicator",value:function(t,e){}},{key:"regeneratePlots",value:function(t){}}]),t}();function Mt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,a=e.calcParams,i=e.plots,n=e.precision,r=e.shouldFormatBigNumber,s=[],o="",c="";if(i.length>0&&(o=e.name),a.length>0){var h=a.map((function(t){return O(t)?t.value:t}));c="(".concat(h.join(","),")")}return i.forEach((function(e){var a={};if(F(e.title)){var i=t[e.key];F(i)&&(i=ft(i,n),r&&(i=pt(i))),a.title=e.title,a.value=i}s.push(a)})),{values:s,name:o,calcParamText:c}}var Lt=function(){function t(e){y(this,t),this._chartData=e,this._templates=this._createTemplates(),this._instances=new Map}return g(t,[{key:"_createTechInfo",value:function(t){return{name:t.name,series:t.series,calcParams:t.calcParams,shouldCheckParamCount:t.shouldCheckParamCount,shouldOhlc:t.shouldOhlc,shouldFormatBigNumber:t.shouldFormatBigNumber,precision:t.precision,styles:t.styles,result:t.result||[]}}},{key:"_createTemplates",value:function(){var t={},e=_.technicalIndicatorExtensions;for(var a in e){var i=this._createTemplateInstance(e[a]);i&&(t[a]=i)}return t}},{key:"_createTemplateInstance",value:function(t){var e=t.name,a=t.series,i=t.calcParams,n=t.plots,r=t.precision,s=t.shouldCheckParamCount,o=t.shouldOhlc,c=t.shouldFormatBigNumber,h=t.minValue,l=t.maxValue,u=t.styles,d=t.calcTechnicalIndicator,v=t.regeneratePlots,_=t.render;if(!e||!L(d))return null;var f=function(t){S(v,t);var d=E(v);function v(){return y(this,v),d.call(this,{name:e,series:a,calcParams:i,plots:n,precision:r,shouldCheckParamCount:s,shouldOhlc:o,shouldFormatBigNumber:c,minValue:h,maxValue:l,styles:u})}return v}(Tt);return f.prototype.calcTechnicalIndicator=d,L(v)&&(f.prototype.regeneratePlots=v),L(_)&&(f.prototype.render=_),new f}},{key:"addTemplate",value:function(t){var e=this;t.forEach((function(t){var a=e._createTemplateInstance(t||{});a&&(e._templates[a.name]=a)}))}},{key:"hasTemplate",value:function(t){return!!this._templates[t]}},{key:"getTemplateInfo",value:function(t){if(!F(t)){var e={};for(var a in this._templates){e[a]=this._createTechInfo(this._templates[a])}return e}var i=this._templates[t];return i?this._createTechInfo(i):{}}},{key:"addInstance",value:function(t,e,a){if(e){var i=e.name,n=e.calcParams,r=e.precision,s=e.shouldOhlc,o=e.shouldFormatBigNumber,c=e.styles,h=this._instances.get(t);if(h&&h.has(i))return!1;h||(h=new Map,this._instances.set(t,h));var l,u=this._templates[i];if(u)for(var d in l=Object.create(Object.getPrototypeOf(u)),u)Object.prototype.hasOwnProperty.call(u,d)&&(l[d]=u[d]);if(l)return l.setCalcParams(n),l.setPrecision(r),l.setShouldOhlc(s),l.setShouldFormatBigNumber(o),l.setStyles(c,this._chartData.styleOptions().technicalIndicator),a||h.clear(),h.set(i,l),l.calc(this._chartData.dataList()),!0}return!1}},{key:"instances",value:function(t){return this._instances.get(t)||new Map}},{key:"removeInstance",value:function(t,e){var a=!1;if(this._instances.has(t)){var i=this._instances.get(t);F(e)?i.has(e)&&(i.delete(e),a=!0):(i.clear(),a=!0),0===i.size&&this._instances.delete(t)}return a}},{key:"hasInstance",value:function(t){return this._instances.has(t)}},{key:"calcInstance",value:function(t,e){var a=this,i=!1;if(F(t))if(F(e)){var n=this._instances.get(e);n&&n.has(t)&&(n.get(t).calc(this._chartData.dataList()),i=!0)}else this._instances.forEach((function(e){e.has(t)&&(e.get(t).calc(a._chartData.dataList()),i=!0)}));else this._instances.forEach((function(t){t.forEach((function(t){t.calc(a._chartData.dataList()),i=!0}))}));return i}},{key:"getInstanceInfo",value:function(t,e){var a=this,i=function(t){var i,n=[],r=I(t);try{for(r.s();!(i=r.n()).done;){var s=i.value[1];if(s){var o=a._createTechInfo(s);if(s.name===e)return o;n.push(o)}}}catch(t){r.e(t)}finally{r.f()}return n};if(!F(t)){var n={};return this._instances.forEach((function(t,e){n[e]=i(t)})),n}return this._instances.has(t)?i(this._instances.get(t)):{}}},{key:"setSeriesPrecision",value:function(t,e){var a=function(a){a.series===At.PRICE&&a.setPrecision(t,!0),a.series===At.VOLUME&&a.setPrecision(e,!0)};for(var i in this._templates)a(this._templates[i]);this._instances.forEach((function(t){t.forEach((function(t){a(t)}))}))}},{key:"override",value:function(t,e){var a=this,i=t.name,n=t.calcParams,r=t.precision,s=t.shouldOhlc,o=t.shouldFormatBigNumber,c=t.styles,h=this._chartData.styleOptions().technicalIndicator,l=new Map;if(F(e))this._instances.has(e)&&l.set(e,this._instances.get(e));else{l=this._instances;var u=this._templates[i];u&&(u.setCalcParams(n),u.setPrecision(r),u.setShouldOhlc(s),u.setShouldFormatBigNumber(o),u.setStyles(c,h))}var d=!1,v=[];if(l.forEach((function(t){if(t.has(i)){var e=t.get(i),l=e.setCalcParams(n),u=e.setPrecision(r),_=e.setShouldOhlc(s),f=e.setShouldFormatBigNumber(o),p=e.setStyles(c,h);(l||u||_||f||p)&&(d=!0),l&&v.push(Promise.resolve(e.calc(a._chartData.dataList())))}})),d)return Promise.all(v)}}]),t}();function Ot(t,e){e.forEach((function(e){var a=e.key,i=e.fn;L(i)&&(t[a]=i)}))}var Rt=function(){function t(e){var a=e.id,i=e.chartData,n=e.xAxis,r=e.yAxis;y(this,t),this._id=a,this._chartData=i,this._xAxis=n,this._yAxis=r,this._styles=null}return g(t,[{key:"draw",value:function(t){}},{key:"setStyles",value:function(t,e){return!!O(t)&&(this._styles||(this._styles=T(e)),A(this._styles,t),!0)}},{key:"id",value:function(){return this._id}},{key:"styles",value:function(){return this._styles}},{key:"setYAxis",value:function(t){t&&(this._yAxis=t)}},{key:"checkEventCoordinateOn",value:function(t){}},{key:"onClick",value:function(t){}},{key:"onRightClick",value:function(t){}},{key:"onMouseEnter",value:function(t){}},{key:"onMouseLeave",value:function(t){}}]),t}();function Ft(t,e,a,i){t.fillStyle=e,t.beginPath(),t.arc(a.x,a.y,i,0,2*Math.PI),t.closePath(),t.fill()}function zt(t,e,a){var i=Math.abs(e.x-t.x),n=Math.abs(e.y-t.y),r=Math.abs(a.x-t.x);return Math.abs(i*Math.abs(a.y-t.y)-r*n)/2}function Bt(t,e){var a=t.x-e.x;if(0!==a){var i=(t.y-e.y)/a;return{k:i,b:t.y-i*t.x}}}function Vt(t,e,a){return Ht(Bt(t,e),a)}function Ht(t,e){return t?e.x*t.k+t.b:e.y}function Yt(t,e,a){if(!a||!t||!e)return!1;if(t.x===e.x)return 2>Math.abs(a.x-t.x);var i=Bt(t,e),n=Ht(i,a),r=Math.abs(n-a.y);return 4>r*r/(i.k*i.k+1)}function Wt(t,e,a){return!!Yt(t,e,a)&&(t.x===e.x?e.y>t.y?2>t.y-a.y:2>a.y-t.y:e.x>t.x?2>t.x-a.x:2>a.x-t.x)}function Nt(t,e,a){return!!Yt(t,e,a)&&(t.x===e.x?4>Math.abs(t.y-a.y)+Math.abs(e.y-a.y)-Math.abs(t.y-e.y):4>Math.abs(t.x-a.x)+Math.abs(e.x-a.x)-Math.abs(t.x-e.x))}function jt(t,e,a){if(!a)return!1;var i=a.x-t.x,n=a.y-t.y;return!(i*i+n*n>e*e)}function Xt(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=[];if(t.length>1)if(t[0].x===t[1].x){var n=0,r=e.y;if(i.push([{x:t[0].x,y:n},{x:t[0].x,y:r}]),t.length>2){i.push([{x:t[2].x,y:n},{x:t[2].x,y:r}]);for(var s=t[0].x-t[2].x,o=0;a>o;o++){var c=s*(o+1);i.push([{x:t[0].x+c,y:n},{x:t[0].x+c,y:r}])}}}else{var h=0,l=e.x,u=Bt(t[0],t[1]),d=u.k,v=u.b;if(i.push([{x:h,y:h*d+v},{x:l,y:l*d+v}]),t.length>2){var _=t[2].y-d*t[2].x;i.push([{x:h,y:h*d+_},{x:l,y:l*d+_}]);for(var f=v-_,p=0;a>p;p++){var m=v+f*(p+1);i.push([{x:h,y:h*d+m},{x:l,y:l*d+m}])}}}return i}function Gt(t,e,a){t.save(),t.lineWidth%2&&t.translate(.5,.5),t.beginPath();var i=!0;e.forEach((function(e){e&&(i?(t.moveTo(e.x,e.y),i=!1):t.lineTo(e.x,e.y))})),a(),t.restore()}function Zt(t,e){Gt(t,e,(function(){t.stroke(),t.closePath()}))}function Ut(t,e){Gt(t,e,(function(){t.closePath(),t.fill()}))}function Kt(t,e,a,i){t.beginPath();var n=t.lineWidth%2?.5:0;t.moveTo(a,e+n),t.lineTo(i,e+n),t.stroke(),t.closePath()}function qt(t,e,a,i){t.beginPath();var n=t.lineWidth%2?.5:0;t.moveTo(e+n,a),t.lineTo(e+n,i),t.stroke(),t.closePath()}function $t(t,e){Zt(t,e)}function Jt(t){return t.ownerDocument&&t.ownerDocument.defaultView&&t.ownerDocument.defaultView.devicePixelRatio||2}function Qt(t,e){return Math.round(t.measureText(e).width)}function te(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"normal",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Helvetica Neue";return"".concat(e," ").concat(t,"px ").concat(a)}var ee="other",ae="point",ie="none",ne="line",re="text",se="continuous_line",oe="polygon",ce="arc",he=0,le=1,ue=2,de={NORMAL:"normal",WEAK_MAGNET:"weak_magnet",STRONG_MAGNET:"strong_magnet"};var ve=function(t){S(a,t);var e=E(a);function a(t){var i,n=t.id,r=t.name,s=t.totalStep,o=t.chartData,c=t.xAxis,h=t.yAxis,l=t.points,u=t.styles,d=t.lock,v=t.data;return y(this,a),(i=e.call(this,{id:n,chartData:o,xAxis:c,yAxis:h}))._name=r,i._totalStep=s,i._lock=d,i._mode=de.NORMAL,i._data=v,i._drawStep=1,i._points=[],i.setPoints(l),i.setStyles(u,o.styleOptions().shape),i._prevPressPoint=null,i._prevPoints=null,i._coordinates=[],i}return g(a,[{key:"setPoints",value:function(t){if(M(t)&&t.length>0){var e;this._totalStep-1>t.length?(this._drawStep=t.length+1,this._points=T(t),e=t.length):(this._drawStep=-1,this._points=t.slice(0,this._totalStep-1),e=this._totalStep-1);for(var a=0;e>a;a++)this.performEventMoveForDrawing({step:a+2,mode:this._mode,points:this._points,movePoint:this._points[a],xAxis:this._xAxis,yAxis:this._yAxis});-1===this._drawStep&&this.performEventPressedMove({mode:this._mode,points:this._points,pressPointIndex:this._points.length-1,pressPoint:this._points[this._points.length-1],xAxis:this._xAxis,yAxis:this._yAxis})}}},{key:"_timestampOrDataIndexToCoordinateX",value:function(t){var e=t.timestamp,a=t.dataIndex;return e&&(a=this._chartData.timeScaleStore().timestampToDataIndex(e)),this._xAxis.convertToPixel(a)}},{key:"_drawLines",value:function(t,e,a,i){t.save(),t.strokeStyle=a.color||i.color,t.lineWidth=a.size||i.size,a.style===Y&&t.setLineDash(a.dashValue||i.dashValue),e.forEach((function(e){var a,i;if(e.length>1)switch((a=e[0]).x===(i=e[1]).x?ue:a.y===i.y?le:he){case he:$t(t,e);break;case le:Kt(t,e[0].y,e[0].x,e[1].x);break;case ue:qt(t,e[0].x,e[0].y,e[1].y)}})),t.restore()}},{key:"_drawContinuousLines",value:function(t,e,a,i){t.save(),t.strokeStyle=a.color||i.color,t.lineWidth=a.size||i.size,a.style===Y&&t.setLineDash(a.dashValue||i.dashValue),e.forEach((function(e){e.length>0&&$t(t,e)})),t.restore()}},{key:"_drawPolygons",value:function(t,e,a,i){var n;if(t.save(),a.style===H)t.fillStyle=(a.fill||i.fill).color,n=Ut;else{var r=a.stroke||i.stroke;r.style===Y&&t.setLineDash(r.dashValue),t.lineWidth=r.size,t.strokeStyle=r.color,n=Zt}e.forEach((function(e){e.length>0&&n(t,e)})),t.restore()}},{key:"_drawArcs",value:function(t,e,a,i){if(t.save(),a.style===H)t.fillStyle=(a.fill||i.fill).color;else{var n=a.stroke||i.stroke;n.style===Y&&t.setLineDash(n.dashValue),t.lineWidth=n.size,t.strokeStyle=n.color}e.forEach((function(e){var i=e.x,n=e.y,r=e.radius,s=e.startAngle,o=e.endAngle;t.beginPath(),t.arc(i,n,r,s,o),a.style===H?(t.closePath(),t.fill()):(t.stroke(),t.closePath())})),t.restore()}},{key:"_drawText",value:function(t,e,a,i){var n;t.save(),a.style===V?(t.strokeStyle=a.color||i.color,n=t.strokeText):(t.fillStyle=a.color||i.color,n=t.fillText),t.font=te(a.size||i.size,a.family||i.family,a.weight||i.weight);var r=a.offset||i.offset||[0,0];e.forEach((function(e){n.call(t,e.text,e.x+r[1],e.y+r[0])})),t.restore()}},{key:"draw",value:function(t){var e=this;this._coordinates=this._points.map((function(t){var a=t.value;return{x:e._timestampOrDataIndexToCoordinateX({timestamp:t.timestamp,dataIndex:t.dataIndex}),y:e._yAxis.convertToPixel(a)}}));var a=this._styles||this._chartData.styleOptions().shape;if(1!==this._drawStep&&this._coordinates.length>0){var i={width:this._xAxis.width(),height:this._yAxis.height()},n={price:this._chartData.pricePrecision(),volume:this._chartData.volumePrecision()};this._shapeDataSources=this.createShapeDataSource({step:this._drawStep,mode:this._mode,points:this._points,coordinates:this._coordinates,viewport:{width:this._xAxis.width(),height:this._yAxis.height()},precision:{price:this._chartData.pricePrecision(),volume:this._chartData.volumePrecision()},styles:a,xAxis:this._xAxis,yAxis:this._yAxis,data:this._data})||[],this._shapeDataSources.forEach((function(i){var n=i.styles,r=i.dataSource,s=void 0===r?[]:r;if(i.isDraw)switch(i.type){case ne:e._drawLines(t,s,n||a.line,a.line);break;case se:e._drawContinuousLines(t,s,n||a.line,a.line);break;case oe:e._drawPolygons(t,s,n||a.polygon,a.polygon);break;case ce:e._drawArcs(t,s,n||a.arc,a.arc);break;case re:e._drawText(t,s,n||a.text,a.text)}})),this.drawExtend&&(t.save(),this.drawExtend({ctx:t,dataSource:this._shapeDataSources,styles:a,viewport:i,precision:n,mode:this._mode,xAxis:this._xAxis,yAxis:this._yAxis,data:this._data}),t.restore())}var r=this._chartData.shapeStore().mouseOperate();(r.hover.id===this._id&&r.hover.element!==ie||r.click.id===this._id&&r.click.element!==ie||this.isDrawing())&&this._coordinates.forEach((function(i,n){var s=i.x,o=i.y,c=a.point.radius,h=a.point.backgroundColor,l=a.point.borderColor,u=a.point.borderSize;r.hover.id===e._id&&r.hover.element===ae&&n===r.hover.elementIndex&&(c=a.point.activeRadius,h=a.point.activeBackgroundColor,l=a.point.activeBorderColor,u=a.point.activeBorderSize),Ft(t,l,{x:s,y:o},c+u),Ft(t,h,{x:s,y:o},c)}))}},{key:"setLock",value:function(t){this._lock=t}},{key:"name",value:function(){return this._name}},{key:"lock",value:function(){return this._lock}},{key:"totalStep",value:function(){return this._totalStep}},{key:"mode",value:function(){return this._mode}},{key:"setMode",value:function(t){Object.values(de).indexOf>-1&&(this._mode=t)}},{key:"setData",value:function(t){return t!==this._data&&(this._data=t,!0)}},{key:"data",value:function(){return this._data}},{key:"points",value:function(){return this._points}},{key:"isDrawing",value:function(){return-1!==this._drawStep}},{key:"isStart",value:function(){return 1===this._drawStep}},{key:"checkEventCoordinateOn",value:function(t){for(var e=this._styles||this._chartData.styleOptions().shape,a=this._coordinates.length-1;a>-1;a--)if(jt(this._coordinates[a],e.point.radius,t))return{id:this._id,element:ae,elementIndex:a,instance:this};if(this._shapeDataSources){var i,n=I(this._shapeDataSources);try{for(n.s();!(i=n.n()).done;){var r=i.value,s=r.key,o=r.type,c=r.dataSource,h=void 0===c?[]:c;if(r.isCheck)for(var l=0;h.length>l;l++){if(this.checkEventCoordinateOnShape({key:s,type:o,dataSource:h[l],eventCoordinate:t}))return{id:this._id,element:ee,elementIndex:l,instance:this}}}}catch(t){n.e(t)}finally{n.f()}}}},{key:"_performValue",value:function(t,e,a){var i=this._yAxis.convertFromPixel(t);if(this._mode===de.NORMAL||"candle_pane"!==a)return i;var n=this._chartData.timeScaleStore().getDataByDataIndex(e);if(!n)return i;if(i>n.high){if(this._mode===de.WEAK_MAGNET){var r=this._yAxis.convertToPixel(n.high);return this._yAxis.convertFromPixel(r-8)>i?n.high:i}return n.high}if(n.low>i){if(this._mode===de.WEAK_MAGNET){var s=this._yAxis.convertToPixel(n.low);return i>this._yAxis.convertFromPixel(s-8)?n.low:i}return n.low}var o=Math.max(n.open,n.close);if(i>o)return n.high-i>i-o?o:n.high;var c=Math.min(n.open,n.close);return c>i?c-i>i-n.low?n.low:c:i-c>o-i?o:c}},{key:"mouseMoveForDrawing",value:function(t,e){var a=this._xAxis.convertFromPixel(t.x),i=this._chartData.timeScaleStore().dataIndexToTimestamp(a),n=this._performValue(t.y,a,e.paneId);this._points[this._drawStep-1]={timestamp:i,value:n,dataIndex:a},this.performEventMoveForDrawing({step:this._drawStep,mode:this._mode,points:this._points,movePoint:{timestamp:i,value:n,dataIndex:a},xAxis:this._xAxis,yAxis:this._yAxis}),this.onDrawing({id:this._id,step:this._drawStep,points:this._points})}},{key:"mouseLeftButtonDownForDrawing",value:function(){this._drawStep===this._totalStep-1?(this._drawStep=-1,this._chartData.shapeStore().progressInstanceComplete(),this.onDrawEnd({id:this._id,points:this._points})):this._drawStep++}},{key:"mousePressedPointMove",value:function(t,e){var a=this._chartData.shapeStore().mouseOperate(),i=a.click.elementIndex;if(!this._lock&&a.click.id===this._id&&a.click.element===ae&&-1!==i){var n=this._xAxis.convertFromPixel(t.x),r=this._chartData.timeScaleStore().dataIndexToTimestamp(n),s=this._performValue(t.y,n,e.paneId);this._points[i].timestamp=r,this._points[i].dataIndex=n,this._points[i].value=s,this.performEventPressedMove({points:this._points,mode:this._mode,pressPointIndex:i,pressPoint:{dataIndex:n,timestamp:r,value:s},xAxis:this._xAxis,yAxis:this._yAxis}),this.onPressedMove({id:a.click.id,points:this._points,event:e})}}},{key:"startPressedOtherMove",value:function(t){var e=this._xAxis.convertFromPixel(t.x),a=this._yAxis.convertFromPixel(t.y);this._prevPressPoint={dataIndex:e,value:a},this._prevPoints=T(this._points)}},{key:"mousePressedOtherMove",value:function(t){var e=this;if(this._prevPressPoint){var a=this._xAxis.convertFromPixel(t.x),i=this._yAxis.convertFromPixel(t.y),n=a-this._prevPressPoint.dataIndex,r=i-this._prevPressPoint.value;this._points=this._prevPoints.map((function(t){F(t.dataIndex)||(t.dataIndex=e._chartData.timeScaleStore().timestampToDataIndex(t.timestamp));var a=t.dataIndex+n;return{dataIndex:a,value:t.value+r,timestamp:e._chartData.timeScaleStore().dataIndexToTimestamp(a)}}))}}},{key:"onDrawStart",value:function(t){}},{key:"onDrawing",value:function(t){}},{key:"onDrawEnd",value:function(t){}},{key:"onPressedMove",value:function(t){}},{key:"onRemove",value:function(t){}},{key:"checkEventCoordinateOnShape",value:function(t){}},{key:"createShapeDataSource",value:function(t){}},{key:"performEventMoveForDrawing",value:function(t){}},{key:"performEventPressedMove",value:function(t){}}]),a}(Rt),_e=function(){function t(e){y(this,t),this._chartData=e,this._templates=this._createTemplates(),this._mouseOperate={click:{id:"",element:ie,elementIndex:-1},hover:{id:"",element:ie,elementIndex:-1}},this._progressInstance=null,this._pressedInstance=null,this._instances=new Map}return g(t,[{key:"_createTemplates",value:function(){var t={},e=_.shapeExtensions;for(var a in e){var i=this._createTemplateClass(e[a]);i&&(t[a]=i)}return t}},{key:"_createTemplateClass",value:function(t){var e=t.name,a=t.totalStep,i=t.checkEventCoordinateOnShape,n=t.createShapeDataSource,r=t.performEventPressedMove,s=t.performEventMoveForDrawing,o=t.drawExtend;if(!(e&&R(a)&&L(i)&&L(n)))return null;var c=function(t){S(n,t);var i=E(n);function n(t){var r=t.id,s=t.chartData,o=t.xAxis,c=t.yAxis,h=t.points,l=t.styles,u=t.lock,d=t.data;return y(this,n),i.call(this,{id:r,name:e,totalStep:a,chartData:s,xAxis:o,yAxis:c,points:h,styles:l,lock:u,data:d})}return n}(ve);return c.prototype.checkEventCoordinateOnShape=i,c.prototype.createShapeDataSource=n,L(r)&&(c.prototype.performEventPressedMove=r),L(s)&&(c.prototype.performEventMoveForDrawing=s),L(o)&&(c.prototype.drawExtend=o),c}},{key:"addTemplate",value:function(t){var e=this;t.forEach((function(t){var a=e._createTemplateClass(t);a&&(e._templates[t.name]=a)}))}},{key:"getTemplate",value:function(t){return this._templates[t]}},{key:"getInstance",value:function(t){var e,a=I(this._instances);try{for(a.s();!(e=a.n()).done;){var i=(e.value[1]||[]).find((function(e){return e.id()===t}));if(i)return i}}catch(t){a.e(t)}finally{a.f()}return null}},{key:"hasInstance",value:function(t){return!!this.getInstance(t)}},{key:"addInstance",value:function(t,e){t.isDrawing()?this._progressInstance={paneId:e,instance:t,fixed:F(e)}:(this._instances.has(e)||this._instances.set(e,[]),this._instances.get(e).push(t)),this._chartData.invalidate(St)}},{key:"progressInstance",value:function(){return this._progressInstance||{}}},{key:"progressInstanceComplete",value:function(){var t=this.progressInstance(),e=t.instance,a=t.paneId;e&&!e.isDrawing()&&(this._instances.has(a)||this._instances.set(a,[]),this._instances.get(a).push(e),this._progressInstance=null)}},{key:"updateProgressInstance",value:function(t,e){var a=this.progressInstance(),i=a.instance;i&&!a.fixed&&(i.setYAxis(t),this._progressInstance.paneId=e)}},{key:"pressedInstance",value:function(){return this._pressedInstance||{}}},{key:"updatePressedInstance",value:function(t,e,a){this._pressedInstance=t?{instance:t,paneId:e,element:a}:null}},{key:"instances",value:function(t){return this._instances.get(t)||[]}},{key:"setInstanceOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.id,a=t.styles,i=t.lock,n=t.mode,r=t.data,s=this._chartData.styleOptions().shape,o=!1;if(F(e)){var c=this.getInstance(e);c&&(c.setLock(i),c.setMode(n),(c.setStyles(a,s)||c.setData(r))&&(o=!0))}else this._instances.forEach((function(t){t.forEach((function(t){t.setLock(i),t.setMode(n),(t.setStyles(a,s)||t.setData(r))&&(o=!0)}))}));o&&this._chartData.invalidate(St)}},{key:"getInstanceInfo",value:function(t){var e=function(t){return{name:t.name(),id:t.id(),totalStep:t.totalStep(),lock:t.lock(),mode:t.mode(),points:t.points(),styles:t.styles(),data:t.data()}},a=this.progressInstance();if(!F(t)){var i={};return this._instances.forEach((function(t,n){i[n]=t.map((function(t){return e(t)})),a.paneId===n&&a.instance&&i[n].push(e(a.instance))})),i}if(a.instance&&a.instance.id()===t)return e(a.instance);var n=this.getInstance(t);return n?e(n):null}},{key:"removeInstance",value:function(t){var e=!1,a=this.progressInstance().instance;if(!a||F(t)&&a.id()!==t||(a.onRemove({id:a.id()}),this._progressInstance=null,e=!0),F(t)){var i,n=I(this._instances);try{for(n.s();!(i=n.n()).done;){var r=i.value,s=r[1]||[],o=s.findIndex((function(e){return e.id()===t}));if(o>-1){s[o].onRemove({id:s[o].id()}),s.splice(o,1),0===s.length&&this._instances.delete(r[0]),e=!0;break}}}catch(t){n.e(t)}finally{n.f()}}else this._instances.forEach((function(t){t.length>0&&t.forEach((function(t){t.onRemove({id:t.id()})}))})),this._instances.clear(),e=!0;e&&this._chartData.invalidate(St)}},{key:"mouseOperate",value:function(){return this._mouseOperate}},{key:"setMouseOperate",value:function(t){var e=this._mouseOperate,a=e.hover,i=e.click;!t.hover||a.id===t.hover.id&&a.element===t.hover.element&&a.elementIndex===t.hover.elementIndex||(this._mouseOperate.hover=p({},t.hover)),!t.click||i.id===t.click.id&&i.element===t.click.element&&i.elementIndex===t.click.elementIndex||(this._mouseOperate.click=p({},t.click))}},{key:"isEmpty",value:function(){return 0===this._instances.size&&!this.progressInstance().instance}},{key:"isDrawing",value:function(){var t=this.progressInstance().instance;return t&&t.isDrawing()}},{key:"isPressed",value:function(){return!!this.pressedInstance().instance}}]),t}(),fe=function(){function t(e){y(this,t),this._chartData=e,this._annotations=new Map,this._visibleAnnotations=new Map,this._mouseOperate={id:""}}return g(t,[{key:"mouseOperate",value:function(){return this._mouseOperate}},{key:"setMouseOperate",value:function(t){t&&this._mouseOperate.id!==t.id&&(this._mouseOperate=p({},t))}},{key:"createVisibleAnnotations",value:function(){var t=this;this._visibleAnnotations.clear(),this._annotations.size>0&&this._chartData.visibleDataList().forEach((function(e){var a=e.data,i=e.x;t._annotations.forEach((function(e,n){if(e.size>0){var r=e.get(a.timestamp)||[];if(r.length>0){var s,o=I(r);try{for(o.s();!(s=o.n()).done;){var c=s.value;c.createSymbolCoordinate(i),t._visibleAnnotations.has(n)?t._visibleAnnotations.get(n).push(c):t._visibleAnnotations.set(n,[c])}}catch(t){o.e(t)}finally{o.f()}}}}))}))}},{key:"add",value:function(t,e){var a=this;this._annotations.has(e)||this._annotations.set(e,new Map),t.forEach((function(t){var i=a._annotations.get(e);i.has(t.id())?i.get(t.id()).push(t):i.set(t.id(),[t])})),this.createVisibleAnnotations(),this._chartData.invalidate(St)}},{key:"get",value:function(t){return this._visibleAnnotations.get(t)}},{key:"remove",value:function(t,e){var a=!1;if(F(t)){if(this._annotations.has(t))if(F(e)){var i=this._annotations.get(t);[].concat(e).forEach((function(t){var e=t.timestamp;i.has(e)&&(a=!0,i.delete(e))})),0===i.size&&this._annotations.delete(t),a&&this.createVisibleAnnotations()}else a=!0,this._annotations.delete(t),this._visibleAnnotations.delete(t)}else a=!0,this._annotations.clear(),this._visibleAnnotations.clear();a&&this._chartData.invalidate(St)}},{key:"isEmpty",value:function(){return 0===this._visibleAnnotations.size}}]),t}(),pe=function(){function t(e){y(this,t),this._chartData=e,this._tags=new Map}return g(t,[{key:"_getById",value:function(t,e){var a=this.get(e);return a?a.get(t):null}},{key:"has",value:function(t,e){return!!this._getById(t,e)}},{key:"update",value:function(t,e,a){var i=this._getById(t,e);return!!i&&i.update(a)}},{key:"get",value:function(t){return this._tags.get(t)}},{key:"add",value:function(t,e){this._tags.has(e)||this._tags.set(e,new Map);var a=this._tags.get(e);t.forEach((function(t){a.set(t.id(),t)})),this._chartData.invalidate(St)}},{key:"remove",value:function(t,e){var a=!1;if(F(t)){if(this._tags.has(t))if(F(e)){var i=this._tags.get(t);[].concat(e).forEach((function(t){i.has(t)&&(a=!0,i.delete(t))})),0===i.size&&this._tags.delete(t)}else a=!0,this._tags.delete(t)}else a=!0,this._tags.clear();a&&this._chartData.invalidate(St)}}]),t}(),me=function(){function t(e){y(this,t),this._chartData=e,this._crosshair={}}return g(t,[{key:"set",value:function(t,e){var a,i,n=this._chartData.dataList(),r=t||{},s=n[i=F(r.x)?0>(a=this._chartData.timeScaleStore().coordinateToDataIndex(r.x))?0:a>n.length-1?n.length-1:a:a=n.length-1],o=this._chartData.timeScaleStore().dataIndexToCoordinate(a),c=this._crosshair.x,h=this._crosshair.y,l=this._crosshair.paneId;this._crosshair=p(p({},r),{},{realX:o,kLineData:s,realDataIndex:a,dataIndex:i}),r.paneId&&s&&this._chartData.crosshairChange({realDataIndex:a,dataIndex:i,kLineData:s,x:r.x,y:r.y}),c===r.x&&h===r.y&&l===r.paneId||e||this._chartData.invalidate(St)}},{key:"recalculate",value:function(t){this.set(this._crosshair,t)}},{key:"get",value:function(){return this._crosshair}}]),t}(),ye=function(){function t(){y(this,t),this._observers=[]}return g(t,[{key:"subscribe",value:function(t){0>this._observers.indexOf(t)&&this._observers.push(t)}},{key:"unsubscribe",value:function(t){var e=this._observers.indexOf(t);e>-1?this._observers.splice(e,1):this._observers=[]}},{key:"execute",value:function(t){this._observers.forEach((function(e){e(t)}))}},{key:"hasObservers",value:function(){return this._observers.length>0}}]),t}(),xe=function(){function t(){y(this,t),this._delegates=new Map}return g(t,[{key:"execute",value:function(t,e){this.has(t)&&this._delegates.get(t).execute(e)}},{key:"has",value:function(t){return this._delegates.has(t)&&this._delegates.get(t).hasObservers()}},{key:"subscribe",value:function(t,e){return Object.values(bt).indexOf(t)>=0&&(this._delegates.has(t)||this._delegates.set(t,new ye),this._delegates.get(t).subscribe(e),!0)}},{key:"unsubscribe",value:function(t,e){if(0>Object.values(bt).indexOf(t))return!1;if(this._delegates.has(t)){var a=this._delegates.get(t);return a.unsubscribe(e),a.hasObservers()||this._delegates.delete(t),!0}return!1}}]),t}(),ge=function(){function t(e,a){y(this,t),this._handler=a,this._styleOptions=T(dt),A(this._styleOptions,e),this._pricePrecision=2,this._volumePrecision=0,this._dataList=[],this._visibleDataList=[],this._dragPaneFlag=!1,this._timeScaleStore=new Et(this),this._technicalIndicatorStore=new Lt(this),this._shapeStore=new _e(this),this._annotationStore=new fe(this),this._tagStore=new pe(this),this._crosshairStore=new me(this),this._actionStore=new xe}return g(t,[{key:"adjustVisibleDataList",value:function(){this._visibleDataList=[];for(var t=this._timeScaleStore.from(),e=this._timeScaleStore.to(),a=t;e>a;a++){var i=this._dataList[a],n=this._timeScaleStore.dataIndexToCoordinate(a);this._visibleDataList.push({index:a,x:n,data:i})}this._annotationStore.createVisibleAnnotations()}},{key:"styleOptions",value:function(){return this._styleOptions}},{key:"applyStyleOptions",value:function(t){A(this._styleOptions,t)}},{key:"pricePrecision",value:function(){return this._pricePrecision}},{key:"volumePrecision",value:function(){return this._volumePrecision}},{key:"setPriceVolumePrecision",value:function(t,e){this._pricePrecision=t,this._volumePrecision=e,this._technicalIndicatorStore.setSeriesPrecision(t,e)}},{key:"dataList",value:function(){return this._dataList}},{key:"visibleDataList",value:function(){return this._visibleDataList}},{key:"addData",value:function(t,e,a){if(O(t)){if(M(t)){this._timeScaleStore.setLoading(!1),this._timeScaleStore.setMore(!z(a)||a);var i=0===this._dataList.length;this._dataList=t.concat(this._dataList),i&&this._timeScaleStore.resetOffsetRightSpace(),this._timeScaleStore.adjustFromTo()}else{if(e<this._dataList.length)this._dataList[e]=t,this.adjustVisibleDataList();else{this._dataList.push(t);var n=this._timeScaleStore.offsetRightBarCount();0>n&&this._timeScaleStore.setOffsetRightBarCount(--n),this._timeScaleStore.adjustFromTo()}}this._crosshairStore.recalculate(!0)}}},{key:"clearDataList",value:function(){this._dataList=[],this._visibleDataList=[],this._timeScaleStore.clear()}},{key:"timeScaleStore",value:function(){return this._timeScaleStore}},{key:"technicalIndicatorStore",value:function(){return this._technicalIndicatorStore}},{key:"shapeStore",value:function(){return this._shapeStore}},{key:"annotationStore",value:function(){return this._annotationStore}},{key:"tagStore",value:function(){return this._tagStore}},{key:"crosshairStore",value:function(){return this._crosshairStore}},{key:"actionStore",value:function(){return this._actionStore}},{key:"invalidate",value:function(t){this._handler.invalidate(t)}},{key:"crosshairChange",value:function(t){this._handler.crosshair(t)}},{key:"dragPaneFlag",value:function(){return this._dragPaneFlag}},{key:"setDragPaneFlag",value:function(t){this._dragPaneFlag=t}}]),t}();function ke(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=document.createElement(t);for(var i in e)a.style[i]=e[i];return a}var Se=function(){function t(e){y(this,t),this._height=-1,this._container=e.container,this._chartData=e.chartData,this._initBefore(e),this._initElement(),this._mainWidget=this._createMainWidget(this._element,e),this._yAxisWidget=this._createYAxisWidget(this._element,e)}return g(t,[{key:"_initBefore",value:function(t){}},{key:"_initElement",value:function(){this._element=ke("div",{width:"100%",margin:"0",padding:"0",position:"relative",overflow:"hidden"});var t=this._container.lastChild;t?this._container.insertBefore(this._element,t):this._container.appendChild(this._element)}},{key:"_createMainWidget",value:function(t,e){}},{key:"_createYAxisWidget",value:function(t,e){}},{key:"width",value:function(){return this._element.offsetWidth}},{key:"setWidth",value:function(t,e){this._mainWidget.setWidth(t),this._yAxisWidget&&this._yAxisWidget.setWidth(e)}},{key:"height",value:function(){return this._height}},{key:"setHeight",value:function(t){this._height=t,this._mainWidget.setHeight(t),this._yAxisWidget&&this._yAxisWidget.setHeight(t)}},{key:"setOffsetLeft",value:function(t,e){this._mainWidget.setOffsetLeft(t),this._yAxisWidget&&this._yAxisWidget.setOffsetLeft(e)}},{key:"layout",value:function(){this._element.offsetHeight!==this._height&&(this._element.style.height="".concat(this._height,"px")),this._mainWidget.layout(),this._yAxisWidget&&this._yAxisWidget.layout()}},{key:"invalidate",value:function(t){this._yAxisWidget&&this._yAxisWidget.invalidate(t),this._mainWidget.invalidate(t)}},{key:"getImage",value:function(t){var e=this._element.offsetWidth,a=this._element.offsetHeight,i=ke("canvas",{width:"".concat(e,"px"),height:"".concat(a,"px")}),n=i.getContext("2d"),r=Jt(i);i.width=e*r,i.height=a*r,n.scale(r,r);var s=this._mainWidget.getElement(),o=s.offsetWidth,c=s.offsetHeight,h=parseInt(s.style.left,10);if(n.drawImage(this._mainWidget.getImage(t),h,0,o,c),this._yAxisWidget){var l=this._yAxisWidget.getElement(),u=l.offsetWidth,d=l.offsetHeight,v=parseInt(l.style.left,10);n.drawImage(this._yAxisWidget.getImage(t),v,0,u,d)}return i}},{key:"destroy",value:function(){this._container.removeChild(this._element)}}]),t}(),De=function(){function t(e){y(this,t),this._width=0,this._height=0,this._initElement(e.container),this._mainView=this._createMainView(this._element,e),this._overlayView=this._createOverlayView(this._element,e)}return g(t,[{key:"_initElement",value:function(t){this._element=ke("div",{margin:"0",padding:"0",position:"absolute",top:"0",overflow:"hidden"}),t.appendChild(this._element)}},{key:"_createMainView",value:function(t,e){}},{key:"_createOverlayView",value:function(t,e){}},{key:"getElement",value:function(){return this._element}},{key:"setWidth",value:function(t){this._width=t,this._mainView.setWidth(t),this._overlayView.setWidth(t)}},{key:"setHeight",value:function(t){this._height=t,this._mainView.setHeight(t),this._overlayView.setHeight(t)}},{key:"setOffsetLeft",value:function(t){this._element.style.left="".concat(t,"px")}},{key:"layout",value:function(){this._element.offsetWidth!==this._width&&(this._element.style.width="".concat(this._width,"px")),this._element.offsetHeight!==this._height&&(this._element.style.height="".concat(this._height,"px")),this._mainView.layout(),this._overlayView.layout()}},{key:"invalidate",value:function(t){switch(t){case St:this._overlayView.flush();break;case Dt:case wt:this._mainView.flush(),this._overlayView.flush()}}},{key:"getImage",value:function(t){var e=ke("canvas",{width:"".concat(this._width,"px"),height:"".concat(this._height,"px")}),a=e.getContext("2d"),i=Jt(e);return e.width=this._width*i,e.height=this._height*i,a.scale(i,i),a.drawImage(this._mainView.getImage(),0,0,this._width,this._height),t&&this._overlayView&&a.drawImage(this._overlayView.getImage(),0,0,this._width,this._height),e}}]),t}();function we(t){return window.requestAnimationFrame?window.requestAnimationFrame(t):window.setTimeout(t,20)}var be=function(){function t(e,a){y(this,t),this._chartData=a,this._initCanvas(e)}return g(t,[{key:"_initCanvas",value:function(t){this._canvas=ke("canvas",{position:"absolute",top:"0",left:"0",zIndex:"2"}),this._ctx=this._canvas.getContext("2d"),t.appendChild(this._canvas)}},{key:"_redraw",value:function(t){this._ctx.clearRect(0,0,this._canvas.offsetWidth,this._canvas.offsetHeight),t&&t(),this._draw()}},{key:"_draw",value:function(){}},{key:"setWidth",value:function(t){this._width=t}},{key:"setHeight",value:function(t){this._height=t}},{key:"layout",value:function(){var t=this;this._height!==this._canvas.offsetHeight||this._width!==this._canvas.offsetWidth?this._redraw((function(){var e=Jt(t._canvas);t._canvas.style.width="".concat(t._width,"px"),t._canvas.style.height="".concat(t._height,"px"),t._canvas.width=Math.floor(t._width*e),t._canvas.height=Math.floor(t._height*e),t._ctx.scale(e,e)})):this.flush()}},{key:"flush",value:function(){var t,e=this;this.requestAnimationId&&(t=this.requestAnimationId,window.cancelAnimationFrame||clearTimeout(t),window.cancelAnimationFrame(t),this.requestAnimationId=null),this.requestAnimationId=we((function(){e._redraw()}))}},{key:"getImage",value:function(){return this._canvas}}]),t}(),Ee=function(t){S(a,t);var e=E(a);function a(t,i,n,r,s){var o;return y(this,a),(o=e.call(this,t,i))._xAxis=n,o._yAxis=r,o._paneId=s,o}return g(a,[{key:"_draw",value:function(){this._ctx.globalCompositeOperation="destination-over",this._drawContent()}},{key:"_drawContent",value:function(){this._drawTechs(),this._drawGrid()}},{key:"_drawGrid",value:function(){var t=this,e=this._chartData.styleOptions().grid;if(e.show){var a=e.horizontal;this._ctx.save(),a.show&&(this._ctx.strokeStyle=a.color,this._ctx.lineWidth=a.size,this._ctx.setLineDash(a.style===Y?a.dashValue:[]),this._yAxis.ticks().forEach((function(e){Kt(t._ctx,e.y,0,t._width)})));var i=e.vertical;i.show&&(this._ctx.strokeStyle=i.color,this._ctx.lineWidth=i.size,this._ctx.setLineDash(i.style===Y?i.dashValue:[]),this._xAxis.ticks().forEach((function(e){qt(t._ctx,e.x,0,t._height)}))),this._ctx.restore()}}},{key:"_drawTechs",value:function(){var t=this;this._ctx.globalCompositeOperation="source-over";var e=this._chartData.styleOptions().technicalIndicator;this._chartData.technicalIndicatorStore().instances(this._paneId).forEach((function(a){var i=a.plots,n=[],r=t._chartData.dataList(),s=a.result,o=a.styles||e;a.render&&(t._ctx.save(),a.render({ctx:t._ctx,dataSource:{from:t._chartData.timeScaleStore().from(),to:t._chartData.timeScaleStore().to(),kLineDataList:t._chartData.dataList(),technicalIndicatorDataList:s},viewport:{width:t._width,height:t._height,dataSpace:t._chartData.timeScaleStore().dataSpace(),barSpace:t._chartData.timeScaleStore().barSpace()},styles:o,xAxis:t._xAxis,yAxis:t._yAxis}),t._ctx.restore());var c=t._yAxis.isCandleYAxis();t._ctx.lineWidth=1,t._drawGraphics((function(e,h,l,u,d){var v=s[h]||{},_=0;a.shouldOhlc&&!c&&t._drawCandleBar(e,u,d,h,l,o.bar,J),i.forEach((function(a){var i=v[a.key],c=t._yAxis.convertToPixel(i);switch(a.type){case It:if(F(i)){var d={prev:{kLineData:r[h-1],technicalIndicatorData:s[h-1]},current:{kLineData:l,technicalIndicatorData:v},next:{kLineData:r[h+1],technicalIndicatorData:s[h+1]}};t._drawCircle({x:e,y:c,radius:u,color:a.color&&a.color(d,o)||o.circle.noChangeColor,isStroke:!a.isStroke||a.isStroke(d)})}break;case Pt:if(F(i)){var f,p={prev:{kLineData:r[h-1],technicalIndicatorData:s[h-1]},current:{kLineData:l,technicalIndicatorData:v},next:{kLineData:r[h+1],technicalIndicatorData:s[h+1]}};f=F(a.baseValue)?a.baseValue:t._yAxis.min();var m=t._yAxis.convertToPixel(f),y=Math.abs(m-c),x={x:e-u,width:2*u,height:Math.max(1,y)};x.y=c>m?m:1>y?m-1:c,x.color=a.color&&a.color(p,o)||o.bar.noChangeColor,x.isStroke=!!a.isStroke&&a.isStroke(p),t._drawBar(x)}break;case Ct:var g=null;F(i)&&(g={x:e,y:c}),n[_]?n[_].push(g):n[_]=[g],_++}}))}),(function(){t._drawLines(n,o)}))})),this._ctx.globalCompositeOperation="destination-over"}},{key:"_drawGraphics",value:function(t,e){var a=this._chartData.visibleDataList(),i=this._chartData.timeScaleStore().barSpace(),n=this._chartData.timeScaleStore().halfBarSpace();a.forEach((function(e,a){t(e.x,e.index,e.data,n,i,a)})),e&&e()}},{key:"_drawLines",value:function(t,e){var a=this,i=e.line.colors||[],n=i.length;this._ctx.lineWidth=e.line.size,t.forEach((function(t,e){a._ctx.strokeStyle=i[e%n],$t(a._ctx,t)}))}},{key:"_drawBar",value:function(t){t.isStroke?(this._ctx.strokeStyle=t.color,this._ctx.strokeRect(t.x+.5,t.y,t.width-1,t.height)):(this._ctx.fillStyle=t.color,this._ctx.fillRect(t.x,t.y,t.width,t.height))}},{key:"_drawCircle",value:function(t){this._ctx.strokeStyle=t.color,this._ctx.fillStyle=t.color,this._ctx.beginPath(),this._ctx.arc(t.x,t.y,t.radius,2*Math.PI,0,!0),t.isStroke?this._ctx.stroke():this._ctx.fill(),this._ctx.closePath()}},{key:"_drawCandleBar",value:function(t,e,a,i,n,r,s){var o=n.open,c=n.close,h=n.high,l=n.low;c>o?(this._ctx.strokeStyle=r.upColor,this._ctx.fillStyle=r.upColor):o>c?(this._ctx.strokeStyle=r.downColor,this._ctx.fillStyle=r.downColor):(this._ctx.strokeStyle=r.noChangeColor,this._ctx.fillStyle=r.noChangeColor);var u=this._yAxis.convertToPixel(o),d=this._yAxis.convertToPixel(c),v=this._yAxis.convertToPixel(h),_=this._yAxis.convertToPixel(l),f=Math.min(u,d),p=Math.max(u,d);this._ctx.fillRect(t-.5,v,1,f-v),this._ctx.fillRect(t-.5,p,1,_-p);var m=Math.max(1,p-f);switch(s){case U:this._ctx.fillRect(t-e,f,a,m);break;case K:this._ctx.strokeRect(t-e+.5,f,a-1,m);break;case q:c>o?this._ctx.strokeRect(t-e+.5,f,a-1,m):this._ctx.fillRect(t-e,f,a,m);break;case $:c>o?this._ctx.fillRect(t-e,f,a,m):this._ctx.strokeRect(t-e+.5,f,a-1,m);break;default:this._ctx.fillRect(t-.5,v,1,_-v),this._ctx.fillRect(t-e,u-.5,e,1),this._ctx.fillRect(t,d-.5,e,1)}}}]),a}(be);function Ce(t,e,a,i,n){t.fillStyle=e,t.fillText(n,a,i)}var Pe=function(t){S(a,t);var e=E(a);function a(t,i,n,r,s){var o;return y(this,a),(o=e.call(this,t,i))._xAxis=n,o._yAxis=r,o._paneId=s,o}return g(a,[{key:"_draw",value:function(){this._ctx.textBaseline="alphabetic",this._drawTag(),this._drawShape(),this._drawAnnotation();var t=this._chartData.crosshairStore().get();if(t.kLineData){var e=this._chartData.styleOptions().crosshair;t.paneId===this._paneId&&this._drawCrosshairLine(e,"horizontal",t.y,0,this._width,Kt),t.paneId&&this._drawCrosshairLine(e,"vertical",t.realX,0,this._height,qt),this._drawTooltip(t,this._chartData.technicalIndicatorStore().instances(this._paneId))}}},{key:"_drawAnnotation",value:function(){var t=this,e=this._chartData.annotationStore().get(this._paneId);e&&e.forEach((function(e){e.draw(t._ctx)}))}},{key:"_drawTag",value:function(){var t=this,e=this._chartData.tagStore().get(this._paneId);e&&e.forEach((function(e){e.drawMarkLine(t._ctx)}))}},{key:"_drawShape",value:function(){var t=this;this._chartData.shapeStore().instances(this._paneId).forEach((function(e){e.draw(t._ctx)}));var e=this._chartData.shapeStore().progressInstance();e.paneId===this._paneId&&e.instance.draw(this._ctx)}},{key:"_drawTooltip",value:function(t,e){var a=this._chartData.styleOptions().technicalIndicator;this._drawBatchTechToolTip(t,e,a,0,this._shouldDrawTooltip(t,a.tooltip))}},{key:"_drawCrosshairLine",value:function(t,e,a,i,n,r){var s=t[e],o=s.line;t.show&&s.show&&o.show&&(this._ctx.save(),this._ctx.lineWidth=o.size,this._ctx.strokeStyle=o.color,o.style===Y&&this._ctx.setLineDash(o.dashValue),r(this._ctx,a,i,n),this._ctx.restore())}},{key:"_drawBatchTechToolTip",value:function(t,e,a){var i=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4?arguments[4]:void 0;if(r){var s=a.tooltip,o=n;e.forEach((function(e){i._drawTechTooltip(t,e,a,o),o+=s.text.marginTop+s.text.size+s.text.marginBottom}))}}},{key:"_drawTechTooltip",value:function(t,e,a){var i=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=a.tooltip,s=e.styles||a,o=e.result,c=o[t.dataIndex],h=Mt(c,e),l=s.line.colors,u=this._chartData.dataList(),d={prev:{kLineData:u[t.dataIndex-1],technicalIndicatorData:o[t.dataIndex-1]},current:{kLineData:u[t.dataIndex],technicalIndicatorData:c},next:{kLineData:u[t.dataIndex+1],technicalIndicatorData:o[t.dataIndex+1]}},v=e.plots,_=r.text,f=h.values,p=_.marginLeft,m=_.marginRight,y=0,x=_.marginTop+n,g=_.size,k=_.color,S=l.length;if(this._ctx.textBaseline="top",this._ctx.font=te(g,_.weight,_.family),r.showName){var D=h.name,w=Qt(this._ctx,D);Ce(this._ctx,k,y+=p,x,D),y+=w,r.showParams||(y+=m)}if(r.showParams){var b=h.calcParamText,E=Qt(this._ctx,b);r.showName||(y+=p),Ce(this._ctx,k,y,x,b),y+=E+m}var C,P=0;v.forEach((function(t,e){switch(t.type){case It:C=t.color&&t.color(d,s)||s.circle.noChangeColor;break;case Pt:C=t.color&&t.color(d,s)||s.bar.noChangeColor;break;case Ct:C=l[P%S]||k,P++}var a=f[e].title;if(F(a)){y+=p;var n="".concat(a).concat(f[e].value||_.defaultValue),r=Qt(i._ctx,n);Ce(i._ctx,C,y,x,n),y+=r+m}}))}},{key:"_shouldDrawTooltip",value:function(t,e){var a=e.showRule;return a===tt||a===et&&!!t.paneId}}]),a}(be),Ie=function(t){S(a,t);var e=E(a);function a(){return y(this,a),e.apply(this,arguments)}return g(a,[{key:"_createMainView",value:function(t,e){return new Ee(t,e.chartData,e.xAxis,e.yAxis,e.paneId)}},{key:"_createOverlayView",value:function(t,e){return new Pe(t,e.chartData,e.xAxis,e.yAxis,e.paneId)}}]),a}(De);function Ae(t,e,a,i,n,r,s,o,c){Me(t,e,n,r,s,o,c),Te(t,a,i,n,r,s,o,c)}function Te(t,e,a,i,n,r,s,o){t.lineWidth=a,t.strokeStyle=e,Le(t,i,n,r,s,o),t.stroke()}function Me(t,e,a,i,n,r,s){t.fillStyle=e,Le(t,a,i,n,r,s),t.fill()}function Le(t,e,a,i,n,r){t.beginPath(),t.moveTo(e+r,a),t.arcTo(e+i,a,e+i,a+n,r),t.arcTo(e+i,a+n,e,a+n,r),t.arcTo(e,a+n,e,a,r),t.arcTo(e,a,e+i,a,r),t.closePath()}var Oe=function(t){S(a,t);var e=E(a);function a(t,i,n,r){var s;return y(this,a),(s=e.call(this,t,i))._yAxis=n,s._paneId=r,s}return g(a,[{key:"_draw",value:function(){var t=this._chartData.styleOptions().yAxis;t.show&&(this._drawAxisLine(t),this._drawTickLines(t),this._drawTickLabels(t),this._drawTechLastValue(),this._drawLastPriceLabel())}},{key:"_drawAxisLine",value:function(t){var e,a=t.axisLine;a.show&&(this._ctx.strokeStyle=a.color,this._ctx.lineWidth=a.size,e=this._yAxis.isFromYAxisZero()?0:this._width-1,qt(this._ctx,e,0,this._height))}},{key:"_drawTickLines",value:function(t){var e=this,a=t.tickLine;if(a.show){this._ctx.lineWidth=a.size,this._ctx.strokeStyle=a.color;var i,n,r=a.length;this._yAxis.isFromYAxisZero()?(i=0,t.axisLine.show&&(i+=t.axisLine.size),n=i+r):(i=this._width,t.axisLine.show&&(i-=t.axisLine.size),n=i-r),this._yAxis.ticks().forEach((function(t){Kt(e._ctx,t.y,i,n)}))}}},{key:"_drawTickLabels",value:function(t){var e=this,a=t.tickText;if(a.show){var i,n=t.tickLine,r=n.show,s=n.length;this._yAxis.isFromYAxisZero()?(i=a.paddingLeft,t.axisLine.show&&(i+=t.axisLine.size),r&&(i+=s),this._ctx.textAlign="left"):(i=this._width-a.paddingRight,t.axisLine.show&&(i-=t.axisLine.size),r&&(i-=s),this._ctx.textAlign="right"),this._ctx.textBaseline="middle",this._ctx.font=te(a.size,a.weight,a.family),this._ctx.fillStyle=a.color,this._yAxis.ticks().forEach((function(t){e._ctx.fillText(t.v,i,t.y)})),this._ctx.textAlign="left"}}},{key:"_drawTechLastValue",value:function(){var t=this,e=this._chartData.styleOptions().technicalIndicator,a=e.lastValueMark;if(a.show&&a.text.show){var i=this._chartData.technicalIndicatorStore().instances(this._paneId),n=this._chartData.dataList();i.forEach((function(i){var r=i.result||[],s=r.length,o=r[s-1]||{},c={prev:{kLineData:n[s-2],technicalIndicatorData:r[s-2]},current:{kLineData:n[s-1],technicalIndicatorData:o},next:{kLineData:null,technicalIndicatorData:null}},h=i.precision,l=i.styles||e,u=l.line.colors||[],d=u.length,v=0;i.plots.forEach((function(e){var n,r=o[e.key];switch(e.type){case It:n=e.color&&e.color(c,l)||l.circle.noChangeColor;break;case Pt:n=e.color&&e.color(c,l)||l.bar.noChangeColor;break;case Ct:n=u[v%d],v++}F(r)&&t._drawMarkLabel(r,h,i.shouldFormatBigNumber,p(p({},a.text),{},{backgroundColor:n}))}))}))}}},{key:"_drawLastPriceLabel",value:function(){if(this._yAxis.isCandleYAxis()){var t=this._chartData.styleOptions().candle.priceMark,e=t.last;if(t.show&&e.show&&e.text.show){var a=this._chartData.dataList(),i=a[a.length-1];if(i){var n,r=i.close,s=i.open;n=r>s?e.upColor:s>r?e.downColor:e.noChangeColor,this._drawMarkLabel(r,this._chartData.pricePrecision(),!1,p(p({},e.text),{},{backgroundColor:n}))}}}}},{key:"_drawMarkLabel",value:function(t,e,a,i){var n,r=i.size,s=i.weight,o=i.family,c=i.color,h=i.backgroundColor,l=i.borderRadius,u=i.paddingLeft,d=i.paddingTop,v=i.paddingRight,_=i.paddingBottom,f=this._yAxis.convertToNicePixel(t);if(this._yAxis.yAxisType()===G){var p=((this._chartData.visibleDataList()[0]||{}).data||{}).close;n="".concat(((t-p)/p*100).toFixed(2),"%")}else n=ft(t,e),a&&(n=pt(n));this._ctx.font=te(r,s,o);var m,y=Qt(this._ctx,n)+u+v,x=d+r+_;m=this._yAxis.isFromYAxisZero()?0:this._width-y,Me(this._ctx,h,m,f-d-r/2,y,x,l),this._ctx.textBaseline="middle",Ce(this._ctx,c,m+u,f,n)}}]),a}(be),Re=function(t){S(a,t);var e=E(a);function a(t,i,n,r){var s;return y(this,a),(s=e.call(this,t,i))._yAxis=n,s._paneId=r,s}return g(a,[{key:"_draw",value:function(){this._ctx.textBaseline="middle",this._drawTag(),this._drawCrossHairLabel()}},{key:"_drawTag",value:function(){var t=this,e=this._chartData.tagStore().get(this._paneId);e&&e.forEach((function(e){e.drawText(t._ctx)}))}},{key:"_drawCrossHairLabel",value:function(){var t=this._chartData.crosshairStore().get();if(t.paneId===this._paneId&&0!==this._chartData.dataList().length){var e=this._chartData.styleOptions().crosshair,a=e.horizontal,i=a.text;if(e.show&&a.show&&i.show){var n,r=this._yAxis.convertFromPixel(t.y);if(this._yAxis.yAxisType()===G){var s=(this._chartData.visibleDataList()[0]||{}).data||{};n="".concat(((r-s.close)/s.close*100).toFixed(2),"%")}else{var o=this._chartData.technicalIndicatorStore().instances(this._paneId),c=0,h=!1;this._yAxis.isCandleYAxis()?c=this._chartData.pricePrecision():o.forEach((function(t){c=Math.max(t.precision,c),h||(h=t.shouldFormatBigNumber)})),n=ft(r,c),h&&(n=pt(n))}var l=i.size;this._ctx.font=te(l,i.weight,i.family);var u,d=Qt(this._ctx,n),v=i.paddingLeft,_=i.paddingTop,f=i.borderSize,p=d+2*f+v+i.paddingRight,m=l+2*f+_+i.paddingBottom;u=this._yAxis.isFromYAxisZero()?0:this._width-p,Ae(this._ctx,i.backgroundColor,i.borderColor,f,u,t.y-f-_-l/2,p,m,i.borderRadius),Ce(this._ctx,i.color,u+f+v,t.y,n)}}}}]),a}(be),Fe=function(t){S(a,t);var e=E(a);function a(){return y(this,a),e.apply(this,arguments)}return g(a,[{key:"_createMainView",value:function(t,e){return new Oe(t,e.chartData,e.yAxis,e.paneId)}},{key:"_createOverlayView",value:function(t,e){return new Re(t,e.chartData,e.yAxis,e.paneId)}}]),a}(De),ze=function(){function t(e){y(this,t),this._chartData=e,this._width=0,this._height=0,this._cacheMinValue=0,this._cacheMaxValue=0,this._minValue=0,this._maxValue=0,this._range=0,this._ticks=[],this._initMeasureCanvas()}return g(t,[{key:"_initMeasureCanvas",value:function(){var t=ke("canvas"),e=Jt(t);this._measureCtx=t.getContext("2d"),this._measureCtx.scale(e,e)}},{key:"min",value:function(){return this._minValue}},{key:"max",value:function(){return this._maxValue}},{key:"width",value:function(){return this._width}},{key:"height",value:function(){return this._height}},{key:"setWidth",value:function(t){this._width=t}},{key:"setHeight",value:function(t){this._height=t}},{key:"ticks",value:function(){return this._ticks}},{key:"computeAxis",value:function(t){var e=this._optimalMinMax(this._computeMinMax());return this._minValue=e.min,this._maxValue=e.max,this._range=e.range,!(this._cacheMinValue===e.min&&this._cacheMaxValue===e.max&&!t)&&(this._cacheMinValue=e.min,this._cacheMaxValue=e.max,this._ticks=this._optimalTicks(this._computeTicks()),!0)}},{key:"_computeMinMax",value:function(){}},{key:"_optimalMinMax",value:function(t){}},{key:"_computeTicks",value:function(){var t=[];if(this._range>=0){var e=this._computeInterval(this._range),a=e.interval,i=e.precision,n=mt(Math.ceil(this._minValue/a)*a,i),r=mt(Math.floor(this._maxValue/a)*a,i),s=0,o=n;if(0!==a)for(;r>=o;)t[s]={v:o.toFixed(i)},++s,o+=a}return t}},{key:"_optimalTicks",value:function(t){}},{key:"_computeInterval",value:function(t){var e,a,i,n,r=(a=Math.floor(yt(e=t/8)),i=xt(a),e=(1.5>(n=e/i)?1:2.5>n?2:3.5>n?3:4.5>n?4:5.5>n?5:6.5>n?6:8)*i,-20>a?e:+e.toFixed(0>a?-a:0)),s=function(t){var e=""+t,a=e.indexOf("e");if(a>0){var i=+e.slice(a+1);return 0>i?-i:0}var n=e.indexOf(".");return 0>n?0:e.length-1-n}(r);return{interval:r,precision:s}}}]),t}(),Be=function(t){S(a,t);var e=E(a);function a(t,i,n){var r;return y(this,a),(r=e.call(this,t))._realRange=0,r._isCandleYAxis=i,r._paneId=n,r}return g(a,[{key:"_computeMinMax",value:function(){var t=this,e=[Number.MAX_SAFE_INTEGER,Number.MIN_SAFE_INTEGER],a=[],i=!1,n=Number.MAX_SAFE_INTEGER,r=Number.MIN_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER;this._chartData.technicalIndicatorStore().instances(this._paneId).forEach((function(t){i||(i=t.shouldOhlc),s=Math.min(s,t.precision),R(t.minValue)&&(n=Math.min(n,t.minValue)),R(t.maxValue)&&(r=Math.max(r,t.maxValue)),a.push({plots:t.plots,result:t.result})}));var o=4;if(this._isCandleYAxis){var c=this._chartData.pricePrecision();o=s!==Number.MAX_SAFE_INTEGER?Math.min(s,c):c}else s!==Number.MAX_SAFE_INTEGER&&(o=s);var h=this._chartData.visibleDataList(),l=this._chartData.styleOptions().candle,u=l.type===Q,d=l.area.value,v=this._isCandleYAxis&&!u||!this._isCandleYAxis&&i;return h.forEach((function(i){var n=i.index,r=i.data;v&&(e[0]=Math.min(e[0],r.low),e[1]=Math.max(e[1],r.high)),t._isCandleYAxis&&u&&(e[0]=Math.min(e[0],r[d]),e[1]=Math.max(e[1],r[d])),a.forEach((function(t){var a=t.result[n]||{};t.plots.forEach((function(t){var i=a[t.key];F(i)&&(e[0]=Math.min(e[0],i),e[1]=Math.max(e[1],i))}))}))})),e[0]!==Number.MAX_SAFE_INTEGER&&e[1]!==Number.MIN_SAFE_INTEGER?(e[0]=Math.min(n,e[0]),e[1]=Math.max(r,e[1])):(e[0]=0,e[1]=10),{min:e[0],max:e[1],precision:o,specifyMin:n,specifyMax:r}}},{key:"_optimalMinMax",value:function(t){var e,a,i,n,r=t.precision,s=t.specifyMin,o=t.specifyMax,c=t.min,h=t.max,l=this.yAxisType();switch(l){case G:var u=(this._chartData.visibleDataList()[0]||{}).data||{};R(u.close)&&(c=(c-u.close)/u.close*100,h=(h-u.close)/u.close*100),e=.01;break;case Z:c=yt(c),h=yt(h),e=.05*xt(-r);break;default:e=xt(-r)}if(c===h||e>Math.abs(c-h)){var d=s===c,v=o===h;c=d?c:v?c-8*e:c-4*e,h=v?h:d?h+8*e:h+4*e}i=(a=this._isCandleYAxis?this._chartData.styleOptions().candle.margin:this._chartData.styleOptions().technicalIndicator.margin).top>1?a.top/this._height:R(a.top)?a.top:.2,n=a.bottom>1?a.bottom/this._height:R(a.bottom)?a.bottom:.1;var _=Math.abs(h-c);return _=Math.abs((h+=_*i)-(c-=_*n)),this._realRange=l===Z?Math.abs(xt(h)-xt(c)):_,{min:c,max:h,range:_}}},{key:"_optimalTicks",value:function(t){var e=this,a=[],i=this.yAxisType(),n=this._chartData.technicalIndicatorStore().instances(this._paneId),r=0,s=!1;this._isCandleYAxis?r=this._chartData.pricePrecision():n.forEach((function(t){r=Math.max(r,t.precision),s||(s=t.shouldFormatBigNumber)}));var o,c,h=this._chartData.styleOptions().xAxis.tickText.size;return i===Z&&(o=this._computeInterval(this._realRange)),t.forEach((function(t){var n,l=t.v,u=e._innerConvertToPixel(+l);switch(i){case G:n="".concat(ft(l,2),"%");break;case Z:n=mt(xt(l),o.precision),u=e._innerConvertToPixel(yt(n)),n=ft(n,r);break;default:n=ft(l,r),s&&(n=pt(n))}u>h&&e._height-h>u&&(c&&c-u>2*h||!c)&&(a.push({v:n,y:u}),c=u)})),a}},{key:"_innerConvertToPixel",value:function(t){return Math.round((1-(t-this._minValue)/this._range)*this._height)}},{key:"isCandleYAxis",value:function(){return this._isCandleYAxis}},{key:"yAxisType",value:function(){return this._isCandleYAxis?this._chartData.styleOptions().yAxis.type:X}},{key:"isFromYAxisZero",value:function(){var t=this._chartData.styleOptions().yAxis;return t.position===N&&t.inside||t.position===j&&!t.inside}},{key:"getSelfWidth",value:function(){var t=this,e=this._chartData.styleOptions(),a=e.yAxis,i=a.width;if(R(i))return i;var n=0;if(a.show&&(a.axisLine.show&&(n+=a.axisLine.size),a.tickLine.show&&(n+=a.tickLine.length),a.tickText.show)){var r=0;this._measureCtx.font=te(a.tickText.size,a.tickText.weight,a.tickText.family),this._ticks.forEach((function(e){r=Math.max(r,Qt(t._measureCtx,e.v))})),n+=a.tickText.paddingLeft+a.tickText.paddingRight+r}var s=e.crosshair,o=0;if(s.show&&s.horizontal.show&&s.horizontal.text.show){var c=this._chartData.technicalIndicatorStore().instances(this._paneId),h=0,l=!1;c.forEach((function(t){h=Math.max(t.precision,h),l||(l=t.shouldFormatBigNumber)})),this._measureCtx.font=te(s.horizontal.text.size,s.horizontal.text.weight,s.horizontal.text.family);var u=2;if(this.yAxisType()!==G)if(this._isCandleYAxis){var d=this._chartData.pricePrecision(),v=e.technicalIndicator.lastValueMark;u=v.show&&v.text.show?Math.max(h,d):d}else u=h;var _=ft(this._maxValue,u);l&&(_=pt(_)),o+=s.horizontal.text.paddingLeft+s.horizontal.text.paddingRight+2*s.horizontal.text.borderSize+Qt(this._measureCtx,_)}return Math.max(n,o)}},{key:"convertFromPixel",value:function(t){var e=(1-t/this._height)*this._range+this._minValue;switch(this.yAxisType()){case G:var a=(this._chartData.visibleDataList()[0]||{}).data||{};if(R(a.close))return a.close*e/100+a.close;break;case Z:return xt(e);default:return e}}},{key:"convertToPixel",value:function(t){var e;switch(this.yAxisType()){case G:var a=(this._chartData.visibleDataList()[0]||{}).data||{};R(a.close)&&(e=(t-a.close)/a.close*100);break;case Z:e=yt(t);break;default:e=t}return this._innerConvertToPixel(e)}},{key:"convertToNicePixel",value:function(t){var e=this.convertToPixel(t);return Math.round(Math.max(.05*this._height,Math.min(e,.98*this._height)))}}]),a}(ze),Ve=function(t){S(a,t);var e=E(a);function a(t){var i;return y(this,a),i=e.call(this,t),"height"in t&&i.setHeight(t.height),i}return g(a,[{key:"_initBefore",value:function(t){this._id=t.id,this._yAxis=this._createYAxis(t)}},{key:"_createYAxis",value:function(t){return new Be(t.chartData,!1,t.id)}},{key:"_createMainWidget",value:function(t,e){return new Ie({container:t,chartData:e.chartData,xAxis:e.xAxis,yAxis:this._yAxis,paneId:e.id})}},{key:"_createYAxisWidget",value:function(t,e){return new Fe({container:t,chartData:e.chartData,yAxis:this._yAxis,paneId:e.id})}},{key:"setHeight",value:function(t){C(D(a.prototype),"setHeight",this).call(this,t),this._yAxis.setHeight(t)}},{key:"setWidth",value:function(t,e){C(D(a.prototype),"setWidth",this).call(this,t,e),this._yAxis.setWidth(e)}},{key:"id",value:function(){return this._id}},{key:"yAxis",value:function(){return this._yAxis}}]),a}(Se),He=function(t){S(a,t);var e=E(a);function a(){return y(this,a),e.apply(this,arguments)}return g(a,[{key:"_drawContent",value:function(){var t=this._chartData.styleOptions().candle;this._drawLastPriceLine(t.priceMark),t.type===Q?this._drawArea(t):(this._drawLowHighPrice(t.priceMark,"high","high",Number.MIN_SAFE_INTEGER,[-2,-5],(function(t,e){if(t>e)return t})),this._drawLowHighPrice(t.priceMark,"low","low",Number.MAX_SAFE_INTEGER,[2,5],(function(t,e){if(e>t)return t})),this._drawCandle(t)),this._drawTechs(),this._drawGrid()}},{key:"_drawArea",value:function(t){var e=this,a=[],i=[],n=Number.MAX_SAFE_INTEGER,r=t.area;this._drawGraphics((function(t,s,o,c,h,l){var u=o[r.value];if(R(u)){var d=e._yAxis.convertToPixel(u);if(0===l){var v=t-c;i.push({x:v,y:e._height}),i.push({x:v,y:d}),a.push({x:v,y:d})}a.push({x:t,y:d}),i.push({x:t,y:d}),n=Math.min(n,d)}}),(function(){var t=i.length;if(t>0){var s=i[t-1],o=e._chartData.timeScaleStore().halfBarSpace(),c=s.x+o;a.push({x:c,y:s.y}),i.push({x:c,y:s.y}),i.push({x:c,y:e._height})}if(a.length>0&&(e._ctx.lineWidth=r.lineSize,e._ctx.strokeStyle=r.lineColor,$t(e._ctx,a)),i.length>0){var h=r.backgroundColor;if(M(h)){var l=e._ctx.createLinearGradient(0,e._height,0,n);try{h.forEach((function(t){l.addColorStop(t.offset,t.color)}))}catch(t){}e._ctx.fillStyle=l}else e._ctx.fillStyle=h;Ut(e._ctx,i)}}))}},{key:"_drawCandle",value:function(t){var e=this;this._drawGraphics((function(a,i,n,r,s){e._drawCandleBar(a,r,s,i,n,t.bar,t.type)}))}},{key:"_drawLowHighPrice",value:function(t,e,a,i,n,r){var s=t[e];if(t.show&&s.show){var o=this._chartData.visibleDataList(),c=i,h=-1;o.forEach((function(t){var e=t.index,n=r(vt(t.data,a,i),c);n&&(c=n,h=e)}));var l=this._chartData.pricePrecision(),u=this._yAxis.convertToPixel(c),d=this._xAxis.convertToPixel(h),v=u+n[0];this._ctx.textAlign="left",this._ctx.lineWidth=1,this._ctx.strokeStyle=s.color,this._ctx.fillStyle=s.color,$t(this._ctx,[{x:d-2,y:v+n[0]},{x:d,y:v},{x:d+2,y:v+n[0]}]);var _=v+n[1];$t(this._ctx,[{x:d,y:v},{x:d,y:_},{x:d+5,y:_}]),this._ctx.font=te(s.textSize,s.textWeight,s.textFamily);var f=ft(c,l);this._ctx.textBaseline="middle",this._ctx.fillText(f,d+5+s.textMargin,_)}}},{key:"_drawLastPriceLine",value:function(t){var e=t.last;if(t.show&&e.show&&e.line.show){var a=this._chartData.dataList(),i=a[a.length-1];if(i){var n,r=i.close,s=i.open,o=this._yAxis.convertToNicePixel(r);n=r>s?e.upColor:s>r?e.downColor:e.noChangeColor,this._ctx.save(),this._ctx.strokeStyle=n,this._ctx.lineWidth=e.line.size,e.line.style===Y&&this._ctx.setLineDash(e.line.dashValue),Kt(this._ctx,o,0,this._width),this._ctx.restore()}}}}]),a}(Ee),Ye=function(t){S(a,t);var e=E(a);function a(){return y(this,a),e.apply(this,arguments)}return g(a,[{key:"_drawTooltip",value:function(t,e){var a=this._chartData.styleOptions(),i=a.candle,n=i.tooltip,r=a.technicalIndicator,s=r.tooltip,o=this._shouldDrawTooltip(t,n),c=this._shouldDrawTooltip(t,s);n.showType===at&&s.showType===at?this._drawCandleTooltipWithRect(t,e,i,o,r,c):n.showType===it?(this._drawCandleTooltipWithStandard(t.kLineData,i,o),s.showType===it?this._drawBatchTechToolTip(t,e,r,o?n.text.size+n.text.marginTop:0,c):this._drawCandleTooltipWithRect(t,e,i,!1,r,c)):(this._drawCandleTooltipWithRect(t,e,i,o,r,!1),this._drawBatchTechToolTip(t,e,r,0,c))}},{key:"_drawCandleTooltipWithStandard",value:function(t,e,a){var i=this;if(a){var n=this._getCandleTooltipData(t,e),r=e.tooltip,s=r.text.marginLeft,o=r.text.marginRight,c=r.text.size,h=r.text.color,l=r.labels;this._ctx.textBaseline="top",this._ctx.font=te(c,r.text.weight,r.text.family);var u=s,d=r.text.marginTop;l.forEach((function(t,e){var a=Qt(i._ctx,t);Ce(i._ctx,h,u,d,t),u+=a;var c,l,v=n[e]||r.defaultValue;O(v)?(c=v.value||r.defaultValue,l=v.color||h):(l=h,c=v);var _=Qt(i._ctx,c);Ce(i._ctx,l,u,d,c),u+=_+s+o}))}}},{key:"_drawCandleTooltipWithRect",value:function(t,e,a,i,n,r){var s=this;if(i||r){var o=a.tooltip,c=o.labels,h=this._getCandleTooltipData(t.kLineData,a),l=o.text.marginLeft,u=o.text.marginRight,d=o.text.marginTop,v=o.text.marginBottom,_=o.text.size,f=o.text.color,p=o.rect,m=p.borderSize,y=p.paddingLeft,x=p.paddingRight,g=p.paddingTop,k=p.paddingBottom,S=p.offsetLeft,D=p.offsetRight,w=0,b=0,E=0;this._ctx.save(),this._ctx.textBaseline="top",i&&(this._ctx.font=te(_,o.text.weight,o.text.family),c.forEach((function(t,e){var a,i=h[e];a=O(i)?i.value||o.defaultValue:i;var n="".concat(t).concat(a),r=Qt(s._ctx,n)+l+u;w=Math.max(w,r)})),E+=(v+d+_)*c.length);var C=n.tooltip,P=C.text.marginLeft,I=C.text.marginRight,A=C.text.marginTop,T=C.text.marginBottom,M=C.text.size,L=[],R=this._chartData.dataList();if(e.forEach((function(e){var a=e.result;L.push({name:e.name,tooltipData:Mt(a[t.dataIndex],e),cbData:{prev:{kLineData:R[t.dataIndex-1],technicalIndicatorData:a[t.dataIndex-1]},current:{kLineData:R[t.dataIndex],technicalIndicatorData:a[t.dataIndex]},next:{kLineData:R[t.dataIndex+1],technicalIndicatorData:a[t.dataIndex+1]}}})})),r&&(this._ctx.font=te(M,C.text.weight,C.text.family),L.forEach((function(t){t.tooltipData.values.forEach((function(t){var e=t.title,a=t.value;if(F(e)){var i=a||C.defaultValue,n="".concat(e).concat(i),r=Qt(s._ctx,n)+P+I;w=Math.max(w,r),E+=A+T+M}}))}))),0!==(b+=w)&&0!==E){var z;b+=2*m+y+x;var B=p.offsetTop,V=p.borderRadius;Me(this._ctx,p.backgroundColor,z=this._width/2>t.realX?this._width-D-b:S,B,b,E+=2*m+g+k,V),Te(this._ctx,p.borderColor,m,z,B,b,E,V);var H=z+m+y+l,Y=B+m+g;if(i&&(this._ctx.font=te(_,o.text.weight,o.text.family),c.forEach((function(t,e){Y+=d,s._ctx.textAlign="left",Ce(s._ctx,f,H,Y,t);var a,i,n=h[e];O(n)?(i=n.color||f,a=n.value||o.defaultValue):(i=f,a=n||o.defaultValue),s._ctx.textAlign="right",Ce(s._ctx,i,z+b-m-u-x,Y,a),Y+=_+v}))),r){var W=this._chartData.styleOptions().technicalIndicator,N=z+m+y+P;this._ctx.font=te(M,C.text.weight,C.text.family),L.forEach((function(t){var a,i=t.tooltipData,n=t.cbData,r=e.get(t.name),o=r.styles||W,c=o.line.colors,h=c.length,l=0;r.plots.forEach((function(t,e){switch(t.type){case It:a=t.color&&t.color(n,o)||o.circle.noChangeColor;break;case Pt:a=t.color&&t.color(n,o)||o.bar.noChangeColor;break;case Ct:a=c[l%h]||o.text.color,l++}var r=i.values[e];F(r.title)&&(Y+=A,s._ctx.textAlign="left",s._ctx.fillStyle=a,s._ctx.fillText("".concat(r.title),N,Y),s._ctx.textAlign="right",s._ctx.fillText(r.value||C.defaultValue,z+b-m-I-x,Y),Y+=M+T)}))}))}this._ctx.restore()}}}},{key:"_getCandleTooltipData",value:function(t,e){var a=this,i=e.tooltip.values,n=[];if(i)L(i)?n=i(t,e)||[]:M(i)&&(n=i);else{var r=this._chartData.pricePrecision(),s=this._chartData.volumePrecision();(n=[vt(t,"timestamp"),vt(t,"open"),vt(t,"close"),vt(t,"high"),vt(t,"low"),vt(t,"volume")]).forEach((function(t,e){switch(e){case 0:n[e]=_t(a._chartData.timeScaleStore().dateTimeFormat(),t,"YYYY-MM-DD hh:mm");break;case n.length-1:n[e]=pt(ft(t,s));break;default:n[e]=ft(t,r)}}))}return n}}]),a}(Pe),We=function(t){S(a,t);var e=E(a);function a(){return y(this,a),e.apply(this,arguments)}return g(a,[{key:"_createMainView",value:function(t,e){return new He(t,e.chartData,e.xAxis,e.yAxis,e.paneId)}},{key:"_createOverlayView",value:function(t,e){return new Ye(t,e.chartData,e.xAxis,e.yAxis,e.paneId)}}]),a}(Ie),Ne=function(t){S(a,t);var e=E(a);function a(){return y(this,a),e.apply(this,arguments)}return g(a,[{key:"_createYAxis",value:function(t){return new Be(t.chartData,!0,t.id)}},{key:"_createMainWidget",value:function(t,e){return new We({container:t,chartData:e.chartData,xAxis:e.xAxis,yAxis:this._yAxis,paneId:e.id})}}]),a}(Ve),je=function(t){S(a,t);var e=E(a);function a(t,i,n){var r;return y(this,a),(r=e.call(this,t,i))._xAxis=n,r}return g(a,[{key:"_draw",value:function(){var t=this._chartData.styleOptions().xAxis;t.show&&(this._drawAxisLine(t),this._drawTickLines(t),this._drawTickLabels(t))}},{key:"_drawAxisLine",value:function(t){var e=t.axisLine;e.show&&(this._ctx.strokeStyle=e.color,this._ctx.lineWidth=e.size,Kt(this._ctx,0,0,this._width))}},{key:"_drawTickLines",value:function(t){var e=this,a=t.tickLine;if(a.show){this._ctx.lineWidth=a.size,this._ctx.strokeStyle=a.color;var i=t.axisLine.show?t.axisLine.size:0,n=i+a.length;this._xAxis.ticks().forEach((function(t){qt(e._ctx,t.x,i,n)}))}}},{key:"_drawTickLabels",value:function(t){var e=t.tickText;if(e.show){var a=t.tickLine;this._ctx.textBaseline="top",this._ctx.font=te(e.size,e.weight,e.family),this._ctx.textAlign="center",this._ctx.fillStyle=e.color;var i=e.paddingTop;t.axisLine.show&&(i+=t.axisLine.size),a.show&&(i+=a.length);for(var n=this._xAxis.ticks(),r=n.length,s=0;r>s;s++)this._ctx.fillText(n[s].v,n[s].x,i)}}}]),a}(be),Xe=function(t){S(a,t);var e=E(a);function a(t,i,n){var r;return y(this,a),(r=e.call(this,t,i))._xAxis=n,r}return g(a,[{key:"_draw",value:function(){this._drawCrosshairLabel()}},{key:"_drawCrosshairLabel",value:function(){var t=this._chartData.crosshairStore().get();if(t.paneId){var e=this._chartData.styleOptions().crosshair,a=e.vertical,i=a.text;if(e.show&&a.show&&i.show&&t.dataIndex===t.realDataIndex){var n=t.realX,r=t.kLineData.timestamp,s=_t(this._chartData.timeScaleStore().dateTimeFormat(),r,"YYYY-MM-DD hh:mm"),o=i.size;this._ctx.font=te(o,i.weight,i.family);var c=Qt(this._ctx,s),h=n-c/2,l=i.paddingLeft,u=i.paddingRight,d=i.paddingTop,v=i.borderSize;l+v>h?h=l+v:h>this._width-c-v-u&&(h=this._width-c-v-u),Ae(this._ctx,i.backgroundColor,i.borderColor,v,h-v-l,0,c+2*v+u+l,o+2*v+d+i.paddingBottom,i.borderRadius),this._ctx.textBaseline="top",Ce(this._ctx,i.color,h,v+d,s)}}}}]),a}(be),Ge=function(t){S(a,t);var e=E(a);function a(){return y(this,a),e.apply(this,arguments)}return g(a,[{key:"_createMainView",value:function(t,e){return new je(t,e.chartData,e.xAxis)}},{key:"_createOverlayView",value:function(t,e){return new Xe(t,e.chartData,e.xAxis)}}]),a}(De),Ze=function(t){S(a,t);var e=E(a);function a(){return y(this,a),e.apply(this,arguments)}return g(a,[{key:"_computeMinMax",value:function(){return{min:this._chartData.timeScaleStore().from(),max:this._chartData.timeScaleStore().to()-1}}},{key:"_optimalMinMax",value:function(t){var e=t.min,a=t.max;return{min:e,max:a,range:a-e+1}}},{key:"_optimalTicks",value:function(t){var e=[],a=t.length,i=this._chartData.dataList();if(a>0){var n=this._chartData.timeScaleStore().dateTimeFormat(),r=this._chartData.styleOptions().xAxis.tickText;this._measureCtx.font=te(r.size,r.weight,r.family);var s=Qt(this._measureCtx,"00-00 00:00"),o=this.convertToPixel(parseInt(t[0].v,10)),c=1;if(a>1){var h=this.convertToPixel(parseInt(t[1].v,10)),l=Math.abs(h-o);s>l&&(c=Math.ceil(s/l))}for(var u=0;a>u;u+=c){var d=parseInt(t[u].v,10),v=i[d].timestamp,_=_t(n,v,"hh:mm");if(0!==u)_=this._optimalTickLabel(n,v,i[parseInt(t[u-c].v,10)].timestamp)||_;var f=this.convertToPixel(d);e.push({v:_,x:f,oV:v})}if(1===e.length)e[0].v=_t(n,e[0].oV,"YYYY-MM-DD hh:mm");else{var p=e[0].oV,m=e[1].oV;if(e[2]){var y=e[2].v;/^[0-9]{2}-[0-9]{2}$/.test(y)?e[0].v=_t(n,p,"MM-DD"):/^[0-9]{4}-[0-9]{2}$/.test(y)?e[0].v=_t(n,p,"YYYY-MM"):/^[0-9]{4}$/.test(y)&&(e[0].v=_t(n,p,"YYYY"))}else e[0].v=this._optimalTickLabel(n,p,m)||e[0].v}}return e}},{key:"_optimalTickLabel",value:function(t,e,a){var i=_t(t,e,"YYYY"),n=_t(t,e,"YYYY-MM"),r=_t(t,e,"MM-DD");return i!==_t(t,a,"YYYY")?i:n!==_t(t,a,"YYYY-MM")?n:r!==_t(t,a,"MM-DD")?r:null}},{key:"getSelfHeight",value:function(){var t=this._chartData.styleOptions(),e=t.xAxis,a=e.height;if(R(a))return a;var i=t.crosshair,n=0;e.show&&(e.axisLine.show&&(n+=e.axisLine.size),e.tickLine.show&&(n+=e.tickLine.length),e.tickText.show&&(n+=e.tickText.paddingTop+e.tickText.paddingBottom+e.tickText.size));var r=0;return i.show&&i.vertical.show&&i.vertical.text.show&&(r+=i.vertical.text.paddingTop+i.vertical.text.paddingBottom+2*i.vertical.text.borderSize+i.vertical.text.size),Math.max(n,r)}},{key:"convertFromPixel",value:function(t){return this._chartData.timeScaleStore().coordinateToDataIndex(t)}},{key:"convertToPixel",value:function(t){return this._chartData.timeScaleStore().dataIndexToCoordinate(t)}}]),a}(ze),Ue=function(t){S(a,t);var e=E(a);function a(){return y(this,a),e.apply(this,arguments)}return g(a,[{key:"_initBefore",value:function(){this._xAxis=new Ze(this._chartData)}},{key:"_createMainWidget",value:function(t,e){return new Ge({container:t,chartData:e.chartData,xAxis:this._xAxis})}},{key:"xAxis",value:function(){return this._xAxis}},{key:"setWidth",value:function(t,e){C(D(a.prototype),"setWidth",this).call(this,t,e),this._xAxis.setWidth(t)}},{key:"setHeight",value:function(t){C(D(a.prototype),"setHeight",this).call(this,t),this._xAxis.setHeight(t)}}]),a}(Se),Ke=0,qe=2;function $e(t){return t.getBoundingClientRect()||{left:0,top:0}}function Je(t){return!!t.touches}function Qe(t){t.cancelable&&t.preventDefault()}var ta=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||"ontouchstart"in window||!!(window.DocumentTouch&&document instanceof window.DocumentTouch),ea="onorientationchange"in window&&ta;function aa(t,e){var a=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(a*a+i*i)}var ia="mouse",na="touch",ra=function(){function t(e,a,i){y(this,t),this._target=e,this._handler=a,this._options=i,this._clickCount=0,this._clickTimeoutId=null,this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartPosition=null,this._moveExceededManhattanDistance=!1,this._cancelClick=!1,this._unsubscribeOutsideEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRoot=null,this._startPinchMiddleCoordinate=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventDragProcess=!1,this._mousePressed=!1,this._init()}return g(t,[{key:"destroy",value:function(){null!==this._unsubscribeOutsideEvents&&(this._unsubscribeOutsideEvents(),this._unsubscribeOutsideEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),this._clearLongTapTimeout(),this._resetClickTimeout()}},{key:"_mouseEnterHandler",value:function(t){var e=this;this._unsubscribeMousemove&&this._unsubscribeMousemove();var a=this._mouseMoveHandler.bind(this),i=this._mouseWheelHandler.bind(this);this._unsubscribeMousemove=function(){e._target.removeEventListener("mousemove",a),e._target.removeEventListener("wheel",i)},this._target.addEventListener("mousemove",a),this._target.addEventListener("wheel",i,{passive:!1}),Je(t)&&this._mouseMoveHandler(t);var n=this._makeCompatEvent(t);this._processEvent(n,this._handler.mouseEnterEvent)}},{key:"_resetClickTimeout",value:function(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null}},{key:"_mouseMoveHandler",value:function(t){if(!this._mousePressed||Je(t)){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseMoveEvent)}}},{key:"_mouseWheelHandler",value:function(t){var e=this._makeCompatEvent(t);t.localX=e.localX,t.localY=e.localY,this._processEvent(t,this._handler.mouseWheelEvent)}},{key:"_mouseMoveWithDownHandler",value:function(t){if((!("button"in t)||t.button===Ke)&&null===this._startPinchMiddleCoordinate){var e=Je(t);if(!this._preventDragProcess||!e){this._pinchPrevented=!0;var a=this._makeCompatEvent(t),i=this._mouseMoveStartPosition,n=Math.abs(i.x-a.pageX),r=Math.abs(i.y-a.pageY),s=n+r>5;if(s||!e){if(s&&!this._moveExceededManhattanDistance&&e){var o=.5*n;r>=o&&!this._options.treatVertTouchDragAsPageScroll||o>r&&!this._options.treatHorzTouchDragAsPageScroll||(this._preventDragProcess=!0)}s&&(this._moveExceededManhattanDistance=!0,this._cancelClick=!0,e&&this._clearLongTapTimeout()),this._preventDragProcess||(this._processEvent(a,this._handler.pressedMouseMoveEvent),e&&Qe(t))}}}}},{key:"_mouseUpHandler",value:function(t){if(!("button"in t)||t.button===Ke){var e=this._makeCompatEvent(t);this._clearLongTapTimeout(),this._mouseMoveStartPosition=null,this._mousePressed=!1,this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),Je(t)&&this._mouseLeaveHandler(t),this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1?(this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()):this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent),Je(t)&&(Qe(t),this._mouseLeaveHandler(t),0===t.touches.length&&(this._longTapActive=!1))}}},{key:"_clearLongTapTimeout",value:function(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}},{key:"_mouseDownHandler",value:function(t){if(!("button"in t)||t.button===Ke||t.button===qe){var e=this._makeCompatEvent(t);if("button"in t&&t.button===qe)this._processEvent(e,this._handler.mouseRightDownEvent);else{this._cancelClick=!1,this._moveExceededManhattanDistance=!1,this._preventDragProcess=!1,Je(t)&&this._mouseEnterHandler(t),this._mouseMoveStartPosition={x:e.pageX,y:e.pageY},this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null);var a=this._mouseMoveWithDownHandler.bind(this),i=this._mouseUpHandler.bind(this),n=this._target.ownerDocument.documentElement;this._unsubscribeRoot=function(){n.removeEventListener("touchmove",a),n.removeEventListener("touchend",i),n.removeEventListener("mousemove",a),n.removeEventListener("mouseup",i)},n.addEventListener("touchmove",a,{passive:!1}),n.addEventListener("touchend",i,{passive:!1}),this._clearLongTapTimeout(),Je(t)&&1===t.touches.length?this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),600):(n.addEventListener("mousemove",a),n.addEventListener("mouseup",i)),this._mousePressed=!0,this._processEvent(e,this._handler.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500))}}}},{key:"_init",value:function(){var t=this;this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));var e=this._target.ownerDocument,a=function(e){t._handler.mouseDownOutsideEvent&&(e.target&&t._target.contains(e.target)||t._handler.mouseDownOutsideEvent())};this._unsubscribeOutsideEvents=function(){e.removeEventListener("mousedown",a),e.removeEventListener("touchstart",a)},e.addEventListener("mousedown",a),e.addEventListener("touchstart",a,{passive:!0}),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._mouseDownHandler.bind(this),{passive:!0}),ea||this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",(function(){}),{passive:!1})}},{key:"_initPinch",value:function(){var t=this;void 0===this._handler.pinchStartEvent&&void 0===this._handler.pinchEvent&&void 0===this._handler.pinchEndEvent||(this._target.addEventListener("touchstart",(function(e){return t._checkPinchState(e.touches)}),{passive:!0}),this._target.addEventListener("touchmove",(function(e){if(2===e.touches.length&&null!==t._startPinchMiddleCoordinate&&void 0!==t._handler.pinchEvent){var a=aa(e.touches[0],e.touches[1]);t._handler.pinchEvent(t._startPinchMiddleCoordinate,a/t._startPinchDistance),Qe(e)}}),{passive:!1}),this._target.addEventListener("touchend",(function(e){t._checkPinchState(e.touches)})))}},{key:"_checkPinchState",value:function(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)}},{key:"_startPinch",value:function(t){var e=$e(this._target);this._startPinchMiddleCoordinate={x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._startPinchDistance=aa(t[0],t[1]),void 0!==this._handler.pinchStartEvent&&this._handler.pinchStartEvent(),this._clearLongTapTimeout()}},{key:"_stopPinch",value:function(){null!==this._startPinchMiddleCoordinate&&(this._startPinchMiddleCoordinate=null,void 0!==this._handler.pinchEndEvent&&this._handler.pinchEndEvent())}},{key:"_mouseLeaveHandler",value:function(t){this._unsubscribeMousemove&&this._unsubscribeMousemove();var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseLeaveEvent)}},{key:"_longTapHandler",value:function(t){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.longTapEvent),this._cancelClick=!0,this._longTapActive=!0}},{key:"_processEvent",value:function(t,e){e&&e.call(this._handler,t)}},{key:"_makeCompatEvent",value:function(t){var e;e="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var a=$e(this._target);return{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,localX:e.clientX-a.left,localY:e.clientY-a.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,type:t.type.startsWith("mouse")?ia:na,target:e.target,view:t.view}}}]),t}(),sa=function(){function t(e,a,i,n,r,s){y(this,t),this._chartData=a,this._topPaneId=i,this._bottomPaneId=n,this._dragEnabled=r,this._width=0,this._offsetLeft=0,this._dragEventHandler=s,this._dragFlag=!1,this._initElement(e),this._initEvent(r)}return g(t,[{key:"_initElement",value:function(t){this._container=t,this._wrapper=ke("div",{margin:"0",padding:"0",position:"relative"}),this._element=ke("div",{width:"100%",height:"7px",margin:"0",padding:"0",position:"absolute",top:"-3px",zIndex:"20"}),this._wrapper.appendChild(this._element);var e=t.lastChild;e?t.insertBefore(this._wrapper,e):t.appendChild(this._wrapper)}},{key:"_initEvent",value:function(t){t&&(this._element.style.cursor="ns-resize",this._dragEvent=new ra(this._element,{mouseDownEvent:this._mouseDownEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),mouseEnterEvent:this._mouseEnterEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this)},{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0}))}},{key:"_mouseDownEvent",value:function(t){this._dragFlag=!0,this._startY=t.pageY,this._dragEventHandler.startDrag(this._topPaneId,this._bottomPaneId)}},{key:"_mouseUpEvent",value:function(){this._dragFlag=!1,this._chartData.setDragPaneFlag(!1)}},{key:"_pressedMouseMoveEvent",value:function(t){this._dragEventHandler.drag(t.pageY-this._startY,this._topPaneId,this._bottomPaneId),this._chartData.setDragPaneFlag(!0),this._chartData.crosshairStore().set()}},{key:"_mouseEnterEvent",value:function(){var t=this._chartData.styleOptions().separator;this._element.style.background=t.activeBackgroundColor,this._chartData.setDragPaneFlag(!0),this._chartData.crosshairStore().set()}},{key:"_mouseLeaveEvent",value:function(){this._dragFlag||(this._element.style.background=null,this._chartData.setDragPaneFlag(!1))}},{key:"height",value:function(){return this._wrapper.offsetHeight}},{key:"setSize",value:function(t,e){this._offsetLeft=t,this._width=e,this.invalidate()}},{key:"setDragEnabled",value:function(t){t!==this._dragEnabled&&(this._dragEnabled=t,t?!this._dragEvent&&this._initEvent(t):(this._element.style.cursor="default",this._dragEvent&&this._dragEvent.destroy(),this._dragEvent=null))}},{key:"topPaneId",value:function(){return this._topPaneId}},{key:"bottomPaneId",value:function(){return this._bottomPaneId}},{key:"updatePaneId",value:function(t,e){F(t)&&(this._topPaneId=t),F(e)&&(this._bottomPaneId=e)}},{key:"invalidate",value:function(){var t=this._chartData.styleOptions().separator;this._element.style.top="".concat(-Math.floor((7-t.size)/2),"px"),this._wrapper.style.backgroundColor=t.color,this._wrapper.style.height="".concat(t.size,"px"),this._wrapper.style.marginLeft="".concat(t.fill?0:this._offsetLeft,"px"),this._wrapper.style.width=t.fill?"100%":"".concat(this._width,"px")}},{key:"getImage",value:function(){var t=this._chartData.styleOptions().separator,e=this._wrapper.offsetWidth,a=t.size,i=ke("canvas",{width:"".concat(e,"px"),height:"".concat(a,"px")}),n=i.getContext("2d"),r=Jt(i);return i.width=e*r,i.height=a*r,n.scale(r,r),n.fillStyle=t.color,n.fillRect(this._offsetLeft,0,e,a),i}},{key:"destroy",value:function(){this._dragEvent&&this._dragEvent.destroy(),this._container.removeChild(this._wrapper)}}]),t}();function oa(t){return t.type===na}function ca(t){return t.type===ia}var ha=function t(e){y(this,t),this._chartData=e},la=function(t){S(a,t);var e=E(a);function a(t){var i;return y(this,a),(i=e.call(this,t))._startScrollCoordinate={},i._touchCoordinate=null,i._touchCancelCrosshair=!1,i._touchZoomed=!1,i._pinchScale=1,i}return g(a,[{key:"pinchStartEvent",value:function(){this._pinchScale=1,this._touchZoomed=!0}},{key:"pinchEvent",value:function(t,e){var a=5*(e-this._pinchScale);this._pinchScale=e,this._chartData.timeScaleStore().zoom(a,t)}},{key:"mouseLeaveEvent",value:function(t){ca(t)&&this._chartData.crosshairStore().set()}},{key:"mouseMoveEvent",value:function(t){ca(t)&&this._chartData.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId})}},{key:"mouseWheelEvent",value:function(t){if(Math.abs(t.deltaX)>Math.abs(t.deltaY)){if(t.cancelable&&t.preventDefault(),0===Math.abs(t.deltaX))return;this._chartData.timeScaleStore().startScroll(),this._chartData.timeScaleStore().scroll(-t.deltaX)}else{var e=-t.deltaY/100;if(0===e)return;switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:e*=120;break;case t.DOM_DELTA_LINE:e*=32}if(0!==e){var a=Math.sign(e)*Math.min(1,Math.abs(e));this._chartData.timeScaleStore().zoom(a,{x:t.localX,y:t.localY})}}}},{key:"mouseClickEvent",value:function(t){oa(t)&&(this._touchCoordinate||this._touchCancelCrosshair||this._touchZoomed||(this._touchCoordinate={x:t.localX,y:t.localY},this._chartData.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId})))}},{key:"mouseDownEvent",value:function(t){if(this._startScrollCoordinate={x:t.localX,y:t.localY},this._chartData.timeScaleStore().startScroll(),oa(t))if(this._touchZoomed=!1,this._touchCoordinate){var e=t.localX-this._touchCoordinate.x,a=t.localY-this._touchCoordinate.y;10>Math.sqrt(e*e+a*a)?(this._touchCoordinate={x:t.localX,y:t.localY},this._chartData.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId})):(this._touchCancelCrosshair=!0,this._touchCoordinate=null,this._chartData.crosshairStore().set())}else this._touchCancelCrosshair=!1}},{key:"pressedMouseMoveEvent",value:function(t){var e={x:t.localX,y:t.paneY,paneId:t.paneId};if(oa(t)){if(this._touchCoordinate)return this._touchCoordinate={x:t.localX,y:t.localY},void this._chartData.crosshairStore().set(e);e=null}var a=t.localX-this._startScrollCoordinate.x;this._chartData.timeScaleStore().scroll(a,e)}},{key:"longTapEvent",value:function(t){oa(t)&&(this._touchCoordinate={x:t.localX,y:t.localY},this._chartData.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId}))}}]),a}(ha),ua=function(t){S(a,t);var e=E(a);function a(t,i){var n;return y(this,a),(n=e.call(this,t))._yAxis=i,n}return g(a,[{key:"_performOverlayMouseHover",value:function(t,e,a,i){var n;if(t){var r,s=I(t);try{for(s.s();!(r=s.n()).done;){if(n=r.value.checkEventCoordinateOn(a))break}}catch(t){s.e(t)}finally{s.f()}n&&e.id===n.id||(e.id&&e.instance&&ca(i)&&e.instance.onMouseLeave({id:e.id,points:e.instance.points(),event:i}),n&&n.id!==e.id&&n.instance&&ca(i)&&n.instance.onMouseEnter({id:n.id,points:n.instance.points(),event:i}))}return n}},{key:"mouseUpEvent",value:function(){this._chartData.shapeStore().updatePressedInstance()}},{key:"mouseMoveEvent",value:function(t){if(this._waitingForMouseMove)return!1;this._waitingForMouseMove=!0;var e,a,i,n={x:t.localX,y:t.paneY},r=this._chartData.shapeStore().progressInstance(),s=r.paneId,o=r.instance;if(o&&o.isDrawing())t.paneId&&(o.isStart()&&this._chartData.shapeStore().updateProgressInstance(this._yAxis(t.paneId),t.paneId),s===t.paneId&&o.mouseMoveForDrawing(n,t),e=o.checkEventCoordinateOn(n)),a={id:"",element:ie,elementIndex:-1};else{var c=this._chartData.annotationStore().get(t.paneId),h=this._chartData.shapeStore().instances(t.paneId),l=this._chartData.shapeStore().mouseOperate().hover,u=this._chartData.annotationStore().mouseOperate();e=this._performOverlayMouseHover(h,l,n,t),i=this._performOverlayMouseHover(c,u,n,t)}this._chartData.shapeStore().setMouseOperate({hover:e||{id:"",element:ie,elementIndex:-1},click:a}),this._chartData.annotationStore().setMouseOperate(i||{id:""}),this._waitingForMouseMove=!1}},{key:"mouseDownEvent",value:function(t){var e,a={x:t.localX,y:t.paneY},i=this._chartData.shapeStore().progressInstance(),n=i.instance,r=i.paneId,s={id:"",element:ie,elementIndex:-1};if(n&&n.isDrawing()&&r===t.paneId)n.mouseLeftButtonDownForDrawing(),e=n.checkEventCoordinateOn(a);else{var o,c=I(this._chartData.shapeStore().instances(t.paneId));try{for(c.s();!(o=c.n()).done;){var h=o.value;if(e=h.checkEventCoordinateOn(a)){this._chartData.shapeStore().updatePressedInstance(h,t.paneId,e.element),e.element===ae?s=p({},e):h.startPressedOtherMove(a),h.onClick({id:e.id,points:h.points(),event:t});break}}}catch(t){c.e(t)}finally{c.f()}var l=this._chartData.annotationStore().get(t.paneId);if(l){var u,d=I(l);try{for(d.s();!(u=d.n()).done;){var v=u.value,_=v.checkEventCoordinateOn(a);if(_){v.onClick({id:_.id,points:v.points(),event:t});break}}}catch(t){d.e(t)}finally{d.f()}}}this._chartData.shapeStore().setMouseOperate({hover:s,click:e||{id:"",element:ie,elementIndex:-1}})&&this._chartData.invalidate(St)}},{key:"mouseRightDownEvent",value:function(t){var e,a=this._chartData.shapeStore().progressInstance().instance;a?e=a:e=this._chartData.shapeStore().instances(t.paneId).find((function(e){return e.checkEventCoordinateOn({x:t.localX,y:t.paneY})}));e&&!e.onRightClick({id:e.id(),points:e.points(),event:t})&&this._chartData.shapeStore().removeInstance(e.id());var i=this._chartData.annotationStore().get(t.paneId);if(i){var n=i.find((function(e){return e.checkEventCoordinateOn({x:t.localX,y:t.paneY})}));n&&n.onRightClick({id:n.id(),points:n.points(),event:t})}}},{key:"pressedMouseMoveEvent",value:function(t){var e=this._chartData.shapeStore().pressedInstance(),a=e.instance;if(a&&e.paneId===t.paneId){var i={x:t.localX,y:t.paneY};e.element===ae?a.mousePressedPointMove(i,t):a.mousePressedOtherMove(i),this._chartData.crosshairStore().set({x:t.localX,y:t.paneY,paneId:t.paneId})}}}]),a}(ha),da="Equal",va="Minus",_a="ArrowLeft",fa="ArrowRight",pa=function(t){S(a,t);var e=E(a);function a(){return y(this,a),e.apply(this,arguments)}return g(a,[{key:"keyBoardDownEvent",value:function(t){if(t.shiftKey)switch(t.code){case da:this._chartData.timeScaleStore().zoom(.5);break;case va:this._chartData.timeScaleStore().zoom(-.5);break;case _a:this._chartData.timeScaleStore().startScroll(),this._chartData.timeScaleStore().scroll(-3*this._chartData.timeScaleStore().dataSpace());break;case fa:this._chartData.timeScaleStore().startScroll(),this._chartData.timeScaleStore().scroll(3*this._chartData.timeScaleStore().dataSpace())}}}]),a}(ha),ma=function(){function t(e,a,i){y(this,t),this._target=e,this._chartData=a,this._chartContentLeftRight={},this._chartContentTopBottom={},this._paneContentSize={},this._event=new ra(this._target,{pinchStartEvent:this._pinchStartEvent.bind(this),pinchEvent:this._pinchEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),mouseClickEvent:this._mouseClickEvent.bind(this),mouseDownEvent:this._mouseDownEvent.bind(this),mouseRightDownEvent:this._mouseRightDownEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this),mouseMoveEvent:this._mouseMoveEvent.bind(this),mouseWheelEvent:this._mouseWheelEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),longTapEvent:this._longTapEvent.bind(this)},{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!1}),this._boundKeyBoardDownEvent=this._keyBoardDownEvent.bind(this),this._target.addEventListener("keydown",this._boundKeyBoardDownEvent),this._boundContextMenuEvent=function(t){t.preventDefault()},this._target.addEventListener("contextmenu",this._boundContextMenuEvent,!1),this._zoomScrollEventHandler=new la(a),this._overlayEventHandler=new ua(a,i),this._keyBoardEventHandler=new pa(a)}return g(t,[{key:"_keyBoardDownEvent",value:function(t){this._keyBoardEventHandler.keyBoardDownEvent(t)}},{key:"_pinchStartEvent",value:function(){this._zoomScrollEventHandler.pinchStartEvent()}},{key:"_pinchEvent",value:function(t,e){this._zoomScrollEventHandler.pinchEvent(t,e)}},{key:"_mouseUpEvent",value:function(t){this._checkEventInChartContent(t)&&(this._target.style.cursor="crosshair"),this._shouldPerformOverlayEvent()&&this._overlayEventHandler.mouseUpEvent(t)}},{key:"_mouseLeaveEvent",value:function(t){this._zoomScrollEventHandler.mouseLeaveEvent(t)}},{key:"_mouseMoveEvent",value:function(t){if(this._checkEventInChartContent(t)){this._target.style.cursor="crosshair";var e=this._compatChartEvent(t,!0);this._shouldPerformOverlayEvent()&&this._overlayEventHandler.mouseMoveEvent(e),this._chartData.dragPaneFlag()||this._zoomScrollEventHandler.mouseMoveEvent(e)}else this._target.style.cursor="default",this._zoomScrollEventHandler.mouseLeaveEvent(t)}},{key:"_mouseWheelEvent",value:function(t){this._checkZoomScroll()&&this._checkEventInChartContent(t)&&this._zoomScrollEventHandler.mouseWheelEvent(this._compatChartEvent(t))}},{key:"_mouseClickEvent",value:function(t){this._checkZoomScroll()&&this._checkEventInChartContent(t)&&this._zoomScrollEventHandler.mouseClickEvent(this._compatChartEvent(t,!0))}},{key:"_mouseDownEvent",value:function(t){if(this._checkEventInChartContent(t)){this._target.style.cursor="pointer";var e=this._compatChartEvent(t,!0);this._shouldPerformOverlayEvent()&&this._overlayEventHandler.mouseDownEvent(e),this._checkZoomScroll()&&this._zoomScrollEventHandler.mouseDownEvent(e)}}},{key:"_mouseRightDownEvent",value:function(t){this._shouldPerformOverlayEvent()&&this._checkEventInChartContent(t)&&this._overlayEventHandler.mouseRightDownEvent(this._compatChartEvent(t,!0))}},{key:"_pressedMouseMoveEvent",value:function(t){if(this._checkEventInChartContent(t)){var e=this._compatChartEvent(t,!0);this._checkZoomScroll()?this._zoomScrollEventHandler.pressedMouseMoveEvent(e):this._overlayEventHandler.pressedMouseMoveEvent(e)}}},{key:"_longTapEvent",value:function(t){this._checkZoomScroll()&&this._checkEventInChartContent(t)&&this._zoomScrollEventHandler.longTapEvent(this._compatChartEvent(t,!0))}},{key:"_checkZoomScroll",value:function(){return!this._chartData.dragPaneFlag()&&!this._chartData.shapeStore().isPressed()&&!this._chartData.shapeStore().isDrawing()}},{key:"_shouldPerformOverlayEvent",value:function(){return!this._chartData.shapeStore().isEmpty()||!this._chartData.annotationStore().isEmpty()}},{key:"_compatChartEvent",value:function(t,e){if(e)for(var a in this._paneContentSize)if(Object.prototype.hasOwnProperty.call(this._paneContentSize,a)){var i=this._paneContentSize[a];if(t.localY>i.contentTop&&i.contentBottom>t.localY){t.paneY=t.localY-i.contentTop,t.paneId=a;break}}return t.localX-=this._chartContentLeftRight.contentLeft,t}},{key:"_checkEventInChartContent",value:function(t){return t.localX>this._chartContentLeftRight.contentLeft&&this._chartContentLeftRight.contentRight>t.localX&&t.localY>this._chartContentTopBottom.contentTop&&this._chartContentTopBottom.contentBottom>t.localY}},{key:"setChartContentLeftRight",value:function(t){this._chartContentLeftRight=t}},{key:"setChartContentTopBottom",value:function(t){this._chartContentTopBottom=t}},{key:"setPaneContentSize",value:function(t){this._paneContentSize=t}},{key:"destroy",value:function(){this._event.destroy(),this._target.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._target.removeEventListener("contextmenu",this._boundContextMenuEvent)}}]),t}();function ya(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,a=0;return function(){var i=Date.now(),n=this,r=arguments;i-a>e&&(t.apply(n,r),a=i)}}var xa=function(t){S(a,t);var e=E(a);function a(t){var i,n=t.id,r=t.point,s=t.chartData,o=t.xAxis,c=t.yAxis,h=t.styles;return y(this,a),(i=e.call(this,{id:n,chartData:s,xAxis:o,yAxis:c}))._point=r,i._symbolCoordinate={},i.setStyles(h,s.styleOptions().annotation),i}return g(a,[{key:"_drawSymbol",value:function(t,e,a){var i=this._chartData.timeScaleStore().barSpace(),n=a.symbol,r=n.size,s=n.activeSize,o=e?R(s)?s:i:R(r)?r:i,c=e?n.activeColor:n.color;switch(n.type){case nt:Ft(t,c,this._symbolCoordinate,o/2);break;case rt:!function(t,e,a,i,n,r){t.fillStyle=e,t.fillRect(a,i,n,r)}(t,c,this._symbolCoordinate.x-o/2,this._symbolCoordinate.y-o/2,o,o);break;case ot:!function(t,e,a,i,n){t.fillStyle=e,t.beginPath(),t.moveTo(a.x-i/2,a.y),t.lineTo(a.x,a.y-n/2),t.lineTo(a.x+i/2,a.y),t.lineTo(a.x,a.y+n/2),t.closePath(),t.fill()}(t,c,this._symbolCoordinate,o,o);break;case st:!function(t,e,a,i,n){t.fillStyle=e,t.beginPath(),t.moveTo(a.x-i/2,a.y+n/2),t.lineTo(a.x,a.y-n/2),t.lineTo(a.x+i/2,a.y+n/2),t.closePath(),t.fill()}(t,c,this._symbolCoordinate,o,o);break;case ct:t.save(),this.drawCustomSymbol({ctx:t,point:this._point,coordinate:this._symbolCoordinate,viewport:{width:this._xAxis.width(),height:this._yAxis.height(),barSpace:i},styles:n,isActive:e}),t.restore()}}},{key:"draw",value:function(t){var e=this._styles||this._chartData.styleOptions().annotation,a=e.offset||[0,0],i=0;switch(e.position){case ht:i=this._yAxis.convertToPixel(this._point.value);break;case lt:i=0;break;case ut:i=this._yAxis.height()}this._symbolCoordinate.y=i+a[0];var n=this._id===this._chartData.annotationStore().mouseOperate().id;this._drawSymbol(t,n,e),this.drawExtend&&(t.save(),this.drawExtend({ctx:t,point:this._point,coordinate:this._symbolCoordinate,viewport:{width:this._xAxis.width(),height:this._yAxis.height()},styles:e,isActive:n}),t.restore())}},{key:"checkEventCoordinateOn",value:function(t){var e,a,i,n,r,s=this._chartData.timeScaleStore().barSpace(),o=(this._styles||this._chartData.styleOptions().annotation).symbol,c=R(o.size)?o.size:s;switch(o.type){case nt:e=jt(this._symbolCoordinate,c/2,t);break;case rt:e=function(t,e,a){return!(t.x>a.x||a.x>e.x||t.y>a.y||a.y>e.y)}({x:this._symbolCoordinate.x-c/2,y:this._symbolCoordinate.y-c/2},{x:this._symbolCoordinate.x+c/2,y:this._symbolCoordinate.y+c/2},t);break;case ot:e=(i=c)*(n=c)/2+2>Math.abs((a=this._symbolCoordinate).x-(r=t).x)*n+Math.abs(a.y-r.y)*i;break;case st:e=function(t,e){var a=zt(t[0],t[1],t[2]),i=zt(t[0],t[1],e)+zt(t[0],t[2],e)+zt(t[1],t[2],e);return 2>Math.abs(a-i)}([{x:this._symbolCoordinate.x-c/2,y:this._symbolCoordinate.y+c/2},{x:this._symbolCoordinate.x,y:this._symbolCoordinate.y-c/2},{x:this._symbolCoordinate.x+c/2,y:this._symbolCoordinate.y+c/2}],t);break;case ct:e=this.checkEventCoordinateOnCustomSymbol({eventCoordinate:t,coordinate:this._symbolCoordinate,size:c})}if(e)return{id:this._id,instance:this}}},{key:"createSymbolCoordinate",value:function(t){var e=this._styles||this._chartData.styleOptions().annotation;this._symbolCoordinate={x:t+(e.offset||[0,0])[1]}}},{key:"points",value:function(){return this._point}},{key:"checkEventCoordinateOnCustomSymbol",value:function(t){}},{key:"drawCustomSymbol",value:function(t){}}]),a}(Rt),ga=function(t){S(a,t);var e=E(a);function a(t){var i,n=t.id,r=t.point,s=t.text,o=t.mark,c=t.chartData,h=t.xAxis,l=t.yAxis,u=t.styles;return y(this,a),(i=e.call(this,{id:n,chartData:c,xAxis:h,yAxis:l}))._point=r||{},i._text=s,i._mark=o,i.setStyles(u,c.styleOptions().tag),i}return g(a,[{key:"update",value:function(t){var e=t.point,a=t.text,i=t.mark,n=t.styles,r=!1;return O(e)&&(this._point=e,r=!0),F(a)&&(this._text=a,r=!0),F(i)&&(this._mark=i,r=!0),this.setStyles(n,this._chartData.styleOptions().tag)&&(r=!0),r}},{key:"drawMarkLine",value:function(t){var e=this._chartData.styleOptions(),a=e.yAxis,i=this._styles||e.tag,n=this._getY(i);t.save(),this._drawLine(t,n,i.line),this._drawMark(t,n,i,a),t.restore()}},{key:"drawText",value:function(t){if(F(this._text)){var e=this._chartData.styleOptions(),a=this._styles||e.tag,i=a.text;t.save(),t.font=te(i.size,i.weight,i.family);var n,r=this._getTextRectWidth(t,i),s=i.paddingTop+i.paddingBottom+i.size;n=this._yAxis.isFromYAxisZero()?0:this._yAxis.width()-r;var o=this._getY(a);Me(t,i.backgroundColor,n,o-s/2,r,s,i.borderRadius),Ce(t,i.color,n+i.paddingLeft,o,this._text),t.restore()}}},{key:"_drawLine",value:function(t,e,a){a.show&&(t.strokeStyle=a.color,t.lineWidth=a.size,a.style===Y&&t.setLineDash(a.dashValue),Kt(t,e,0,this._xAxis.width()))}},{key:"_drawMark",value:function(t,e,a,i){if(F(this._mark)){var n=a.mark;t.font=te(n.size,n.weight,n.family);var r,s=n.paddingLeft+n.paddingRight+Qt(t,this._mark),o=n.paddingTop+n.paddingBottom+n.size;if(i.inside){var c=0;F(this._text)&&(c=this._getTextRectWidth(t,a.text)),r=i.position===N?c:this._xAxis.width()-c-s}else r=i.position===N?0:this._xAxis.width()-s;Me(t,n.backgroundColor,r,e-o/2,s,o,n.borderRadius),t.textBaseline="middle",t.font=te(n.size,n.weight,n.family),Ce(t,n.color,r+n.paddingLeft,e,this._mark)}}},{key:"_getY",value:function(t){var e=t.offset;switch(t.position){case lt:return e;case ut:return this._yAxis.height()+e;default:return this._yAxis.convertToNicePixel(this._point.value)+e}}},{key:"_getTextRectWidth",value:function(t,e){return t.font=te(e.size,e.weight,e.family),e.paddingLeft+e.paddingRight+Qt(t,this._text)}}]),a}(Rt),ka=function(){function t(e,a){var i=this;y(this,t),this._initChartContainer(e),this._shapeBaseId=0,this._paneBaseId=0,this._separatorDragStartTopPaneHeight=0,this._separatorDragStartBottomPaneHeight=0,this._chartData=new ge(a,{invalidate:this._invalidatePane.bind(this),crosshair:this._crosshairObserver.bind(this)}),this._xAxisPane=new Ue({container:this._chartContainer,chartData:this._chartData}),this._panes=new Map([[kt,new Ne({container:this._chartContainer,chartData:this._chartData,xAxis:this._xAxisPane.xAxis(),id:kt})]]),this._separators=new Map,this._chartWidth={},this._chartHeight={},this._chartEvent=new ma(this._chartContainer,this._chartData,(function(t){return i._panes.get(t).yAxis()})),this.adjustPaneViewport(!0,!0,!0)}return g(t,[{key:"_initChartContainer",value:function(t){this._container=t,this._chartContainer=ke("div",{userSelect:"none",webkitUserSelect:"none",msUserSelect:"none",MozUserSelect:"none",webkitTapHighlightColor:"transparent",position:"relative",outline:"none",borderStyle:"none",width:"100%",cursor:"crosshair"}),this._chartContainer.tabIndex=1,t.appendChild(this._chartContainer)}},{key:"_crosshairObserver",value:function(t){var e=this,a=t.dataIndex,i=t.kLineData,n=t.x,r=t.y;if(this.chartData().actionStore().has(bt.CROSSHAIR)){var s={};this._panes.forEach((function(t,i){var n={};e.chartData().technicalIndicatorStore().instances(i).forEach((function(t){n[t.name]=t.result[a]})),s[i]=n})),this._chartData.actionStore().execute(bt.CROSSHAIR,{coordinate:{x:n,y:r},dataIndex:a,kLineData:i,technicalIndicatorData:s})}}},{key:"_separatorStartDrag",value:function(t,e){this._separatorDragStartTopPaneHeight=this._panes.get(t).height(),this._separatorDragStartBottomPaneHeight=this._panes.get(e).height()}},{key:"_separatorDrag",value:function(t,e,a){var i=this._separatorDragStartTopPaneHeight+t,n=this._separatorDragStartBottomPaneHeight-t;i>this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight&&(i=this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight,n=0),0>i&&(i=0,n=this._separatorDragStartTopPaneHeight+this._separatorDragStartBottomPaneHeight),this._panes.get(e).setHeight(i),this._panes.get(a).setHeight(n),this._chartData.actionStore().execute(bt.PANE_DRAG,{topPaneId:e,bottomPaneId:a,topPaneHeight:i,bottomPaneHeight:n}),this.adjustPaneViewport(!0,!0,!0,!0,!0)}},{key:"_invalidatePane",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wt;if(t===St)this._xAxisPane.invalidate(t),this._panes.forEach((function(e){e.invalidate(t)}));else{var e=!1;this._panes.forEach((function(t){var a=t.yAxis().computeAxis();a&&(e=a)})),this.adjustPaneViewport(!1,e,!0)}}},{key:"_measurePaneHeight",value:function(){var t=this,e=this._chartData.styleOptions(),a=this._container.offsetHeight,i=e.separator.size,n=i*this._separators.size,r=this._xAxisPane.xAxis().getSelfHeight(),s=a-r-n,o=0;this._panes.forEach((function(t){if(t.id()!==kt){var e=t.height();o+e>s?(t.setHeight(s-o),o=s):o+=e}}));var c=s-o,h={};h.candle_pane={contentTop:0,contentBottom:c};var l=c,u=c;this._panes.get(kt).setHeight(c),this._chartHeight.candle_pane=c,this._panes.forEach((function(e){if(e.id()!==kt){var a=e.height();u+=a+i,h[e.id()]={contentTop:l,contentBottom:u},t._chartHeight[e.id()]=a,l=u}})),this._xAxisPane.setHeight(r),this._chartHeight.xAxis=r,this._chartHeight.total=a,this._chartEvent.setPaneContentSize(h),this._chartEvent.setChartContentTopBottom({contentTop:0,contentBottom:u})}},{key:"_measurePaneWidth",value:function(){var t,e,a,i=this,n=this._chartData.styleOptions().yAxis,r=n.position===N,s=this._container.offsetWidth,o=Number.MIN_SAFE_INTEGER;!n.inside?(this._panes.forEach((function(t){o=Math.max(o,t.yAxis().getSelfWidth())})),t=s-o,r?(e=0,a=o):(a=0,e=s-o)):(t=s,o=s,e=0,a=0),this._chartData.timeScaleStore().setTotalDataSpace(t),this._panes.forEach((function(n,r){n.setWidth(t,o),n.setOffsetLeft(a,e);var s=i._separators.get(r);s&&s.setSize(a,t)})),this._chartWidth={content:t,yAxis:o,total:s},this._xAxisPane.setWidth(t,o),this._xAxisPane.setOffsetLeft(a,e),this._chartEvent.setChartContentLeftRight({contentLeft:a,contentRight:a+t})}},{key:"adjustPaneViewport",value:function(t,e,a,i,n){t&&this._measurePaneHeight();var r=!1;i&&this._panes.forEach((function(t){var e=t.yAxis().computeAxis(n);r||(r=e)})),(!i&&e||i&&r)&&this._measurePaneWidth(),a&&(this._xAxisPane.xAxis().computeAxis(!0),this._xAxisPane.layout(),this._panes.forEach((function(t){t.layout()})))}},{key:"hasPane",value:function(t){return this._panes.has(t)}},{key:"chartData",value:function(){return this._chartData}},{key:"removeTechnicalIndicator",value:function(t,e){var a=this;if(this._chartData.technicalIndicatorStore().removeInstance(t,e)){var i=!1;if(t!==kt&&!this._chartData.technicalIndicatorStore().hasInstance(t)){i=!0,this._panes.get(t).destroy();var n=this._separators.get(t).topPaneId();this._separators.get(t).destroy(),this._panes.delete(t),this._separators.delete(t),this._separators.forEach((function(t){var e=t.topPaneId();a._separators.has(e)||t.updatePaneId(n)}))}this.adjustPaneViewport(i,!0,!0,!0,!0)}}},{key:"createTechnicalIndicator",value:function(t,e){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._panes.has(a.id)){var i=!1;return this._chartData.technicalIndicatorStore().addInstance(a.id,t,e)&&(i=this._panes.get(a.id).yAxis().computeAxis()),this.setPaneOptions(a,i),a.id}var n=a.id||"".concat(gt).concat(++this._paneBaseId),r=!z(a.dragEnabled)||a.dragEnabled;this._separators.set(n,new sa(this._chartContainer,this._chartData,Array.from(this._panes.keys()).pop(),n,r,{startDrag:this._separatorStartDrag.bind(this),drag:ya(this._separatorDrag.bind(this),50)}));var s=new Ve({container:this._chartContainer,chartData:this._chartData,xAxis:this._xAxisPane.xAxis(),id:n,height:a.height||100});return this._panes.set(n,s),this._chartData.technicalIndicatorStore().addInstance(n,t,e),this.adjustPaneViewport(!0,!0,!0,!0,!0),n}},{key:"createShape",value:function(t,e,a){var i=e.points,n=e.styles,r=e.lock,s=e.data,o=e.onDrawStart,c=e.onDrawing,h=e.onDrawEnd,l=e.onClick,u=e.onRightClick,d=e.onPressedMove,v=e.onMouseEnter,_=e.onMouseLeave,f=e.onRemove,p=e.id||"".concat("shape_").concat(++this._shapeBaseId);if(!this._chartData.shapeStore().hasInstance(p)){var m=null;this.hasPane(a)?m=this._panes.get(a).yAxis():i&&i.length>0&&(a=kt,m=this._panes.get(kt).yAxis());var y=new t({id:p,chartData:this._chartData,xAxis:this._xAxisPane.xAxis(),yAxis:m,points:i,styles:n,lock:r,data:s});return L(o)&&o({id:p}),Ot(y,[{key:"onDrawing",fn:c},{key:"onDrawEnd",fn:h},{key:"onClick",fn:l},{key:"onRightClick",fn:u},{key:"onPressedMove",fn:d},{key:"onMouseEnter",fn:v},{key:"onMouseLeave",fn:_},{key:"onRemove",fn:f}]),this._chartData.shapeStore().addInstance(y,a),p}return null}},{key:"createAnnotation",value:function(t,e){var a=this,i=[];t.forEach((function(t){var n=t.point,r=t.styles,s=t.checkEventCoordinateOnCustomSymbol,o=t.drawCustomSymbol,c=t.drawExtend,h=t.onClick,l=t.onRightClick,u=t.onMouseEnter,d=t.onMouseLeave;if(n&&n.timestamp){var v=new xa({id:n.timestamp,chartData:a._chartData,point:n,xAxis:a._xAxisPane.xAxis(),yAxis:a._panes.get(e).yAxis(),styles:r});Ot(v,[{key:"drawExtend",fn:c},{key:"drawCustomSymbol",fn:o},{key:"checkEventCoordinateOnCustomSymbol",fn:s},{key:"onClick",fn:h},{key:"onRightClick",fn:l},{key:"onMouseEnter",fn:u},{key:"onMouseLeave",fn:d}]),i.push(v)}})),i.length>0&&this._chartData.annotationStore().add(i,e)}},{key:"createTag",value:function(t,e){var a=this,i=[],n=!1,r=!1;t.forEach((function(t){var s=t.id,o=t.point,c=t.text,h=t.mark,l=t.styles;if(F(s))if(a._chartData.tagStore().has(s,e)){var u=a._chartData.tagStore().update(s,e,{point:o,text:c,mark:h,styles:l});n||(n=u)}else r=!0,i.push(new ga({id:s,point:o,text:c,mark:h,styles:l,chartData:a._chartData,xAxis:a._xAxisPane.xAxis(),yAxis:a._panes.get(e).yAxis()}))})),r?this._chartData.tagStore().add(i,e):n&&this._invalidatePane(St)}},{key:"setPaneOptions",value:function(t,e){var a=e,i=!1;if(t.id!==kt){var n=this._panes.get(t.id);n&&(R(t.height)&&t.height>0&&n.height()!==t.height&&(a=!0,n.setHeight(t.height),i=!0),z(t.dragEnabled)&&this._separators.get(t.id).setDragEnabled(t.dragEnabled))}a&&this.adjustPaneViewport(i,!0,!0,!0,!0)}},{key:"setTimezone",value:function(t){this._chartData.timeScaleStore().setTimezone(t),this._xAxisPane.xAxis().computeAxis(!0),this._xAxisPane.invalidate(wt)}},{key:"convertToPixel",value:function(t,e){var a,i=this,n=e.paneId,r=void 0===n?kt:n,s=e.absoluteYAxis,o=[].concat(t),c=[],h=this._chartData.styleOptions().separator.size,l=0,u=I(this._panes.values());try{var d=function(){var t=a.value;if(t.id()===r)return c=o.map((function(e){var a=e.timestamp,n=e.value,r={},o=e.dataIndex;if(F(a)&&(o=i._chartData.timeScaleStore().timestampToDataIndex(a)),F(o)&&(r.x=i._xAxisPane.xAxis().convertToPixel(o)),F(n)){var c=t.yAxis().convertToPixel(n);r.y=s?l+c:c}return r})),"break";l+=t.height()+h};for(u.s();!(a=u.n()).done;){if("break"===d())break}}catch(t){u.e(t)}finally{u.f()}return M(t)?c:c[0]||{}}},{key:"convertFromPixel",value:function(t,e){var a,i=this,n=e.paneId,r=void 0===n?kt:n,s=e.absoluteYAxis,o=[].concat(t),c=[],h=this._chartData.styleOptions().separator.size,l=0,u=I(this._panes.values());try{var d=function(){var t=a.value;if(t.id()===r)return c=o.map((function(e){var a=e.x,n=e.y,r={};if(F(a)&&(r.dataIndex=i._xAxisPane.xAxis().convertFromPixel(a),r.timestamp=i._chartData.timeScaleStore().dataIndexToTimestamp(r.dataIndex)),F(n)){var o=s?n-l:n;r.value=t.yAxis().convertFromPixel(o)}return r})),"break";l+=t.height()+h};for(u.s();!(a=u.n()).done;){if("break"===d())break}}catch(t){u.e(t)}finally{u.f()}return M(t)?c:c[0]||{}}},{key:"chartWidth",value:function(){return this._chartWidth}},{key:"chartHeight",value:function(){return this._chartHeight}},{key:"getConvertPictureUrl",value:function(t,e,a){var i=this,n=this._chartContainer.offsetWidth,r=this._chartContainer.offsetHeight,s=ke("canvas",{width:"".concat(n,"px"),height:"".concat(r,"px")}),o=s.getContext("2d"),c=Jt(s);s.width=n*c,s.height=r*c,o.scale(c,c),o.fillStyle=a,o.fillRect(0,0,n,r);var h=0;return this._panes.forEach((function(e,a){if(a!==kt){var r=i._separators.get(a);o.drawImage(r.getImage(),0,h,n,r.height()),h+=r.height()}o.drawImage(e.getImage(t),0,h,n,e.height()),h+=e.height()})),o.drawImage(this._xAxisPane.getImage(t),0,h,n,this._xAxisPane.height()),s.toDataURL("image/".concat(e))}},{key:"destroy",value:function(){this._panes.forEach((function(t){t.destroy()})),this._separators.forEach((function(t){t.destroy()})),this._panes.clear(),this._separators.clear(),this._xAxisPane.destroy(),this._container.removeChild(this._chartContainer),this._chartEvent.destroy()}}]),t}(),Sa=function(){function t(e,a){y(this,t),this._chartPane=new ka(e,a)}return g(t,[{key:"getWidth",value:function(){return this._chartPane.chartWidth()}},{key:"getHeight",value:function(){return this._chartPane.chartHeight()}},{key:"setStyleOptions",value:function(t){O(t)&&(this._chartPane.chartData().applyStyleOptions(t),this._chartPane.adjustPaneViewport(!0,!0,!0,!0,!0))}},{key:"getStyleOptions",value:function(){return T(this._chartPane.chartData().styleOptions())}},{key:"setPriceVolumePrecision",value:function(t,e){R(t)&&t>=0&&R(e)&&e>=0&&this._chartPane.chartData().setPriceVolumePrecision(t,e)}},{key:"setTimezone",value:function(t){this._chartPane.setTimezone(t)}},{key:"getTimezone",value:function(){return this._chartPane.chartData().timeScaleStore().timezone()}},{key:"resize",value:function(){this._chartPane.adjustPaneViewport(!0,!0,!0,!0,!0)}},{key:"setOffsetRightSpace",value:function(t){R(t)&&this._chartPane.chartData().timeScaleStore().setOffsetRightSpace(t,!0)}},{key:"setLeftMinVisibleBarCount",value:function(t){R(t)&&t>0&&this._chartPane.chartData().timeScaleStore().setLeftMinVisibleBarCount(Math.ceil(t))}},{key:"setRightMinVisibleBarCount",value:function(t){R(t)&&t>0&&this._chartPane.chartData().timeScaleStore().setRightMinVisibleBarCount(Math.ceil(t))}},{key:"setDataSpace",value:function(t){R(t)&&this._chartPane.chartData().timeScaleStore().setDataSpace(t)}},{key:"getDataSpace",value:function(){return this._chartPane.chartData().timeScaleStore().dataSpace()}},{key:"getBarSpace",value:function(){return this._chartPane.chartData().timeScaleStore().barSpace()}},{key:"clearData",value:function(){this._chartPane.chartData().clearDataList()}},{key:"getDataList",value:function(){return this._chartPane.chartData().dataList()}},{key:"applyNewData",value:function(t,e){var a=this;if(M(t)){var i=this._chartPane.chartData();i.clearDataList(),i.addData(t,0,e),Promise.resolve(i.technicalIndicatorStore().calcInstance()).then((function(t){t&&a._chartPane.adjustPaneViewport(!1,!0,!0,!0)}))}}},{key:"applyMoreData",value:function(t,e){var a=this;if(M(t)){var i=this._chartPane.chartData();i.addData(t,0,e),Promise.resolve(i.technicalIndicatorStore().calcInstance()).then((function(t){t&&a._chartPane.adjustPaneViewport(!1,!0,!0,!0)}))}}},{key:"updateData",value:function(t){var e=this;if(O(t)&&!M(t)){var a=this._chartPane.chartData(),i=a.dataList(),n=i.length,r=vt(t,"timestamp",0),s=vt(i[n-1],"timestamp",0);if(r>=s){var o=n;r===s&&(o=n-1),a.addData(t,o),Promise.resolve(a.technicalIndicatorStore().calcInstance()).then((function(t){t&&e._chartPane.adjustPaneViewport(!1,!0,!0,!0)}))}}}},{key:"loadMore",value:function(t){L(t)&&this._chartPane.chartData().timeScaleStore().setLoadMoreCallback(t)}},{key:"createTechnicalIndicator",value:function(t,e,a){if(!F(t))return null;var i=O(t)&&!M(t)?t:{name:t};return this._chartPane.chartData().technicalIndicatorStore().hasTemplate(i.name)?this._chartPane.createTechnicalIndicator(i,e,a):null}},{key:"addTechnicalIndicatorTemplate",value:function(t){if(O(t)){var e=[].concat(t);this._chartPane.chartData().technicalIndicatorStore().addTemplate(e)}}},{key:"overrideTechnicalIndicator",value:function(t,e){var a=this;if(O(t)&&!M(t)){var i=this._chartPane.chartData().technicalIndicatorStore().override(t,e);i&&i.then((function(t){a._chartPane.adjustPaneViewport(!1,!0,!0,!0)}))}}},{key:"getTechnicalIndicatorTemplate",value:function(t){return this._chartPane.chartData().technicalIndicatorStore().getTemplateInfo(t)}},{key:"getTechnicalIndicatorByPaneId",value:function(t,e){return this._chartPane.chartData().technicalIndicatorStore().getInstanceInfo(t,e)}},{key:"removeTechnicalIndicator",value:function(t,e){this._chartPane.removeTechnicalIndicator(t,e)}},{key:"addShapeTemplate",value:function(t){if(O(t)){var e=[].concat(t);this._chartPane.chartData().shapeStore().addTemplate(e)}}},{key:"createShape",value:function(t,e){if(!F(t))return null;var a=O(t)&&!M(t)?t:{name:t},i=this._chartPane.chartData().shapeStore().getTemplate(a.name);return i?this._chartPane.createShape(i,a,e):null}},{key:"getShape",value:function(t){return this._chartPane.chartData().shapeStore().getInstanceInfo(t)}},{key:"setShapeOptions",value:function(t){O(t)&&!M(t)&&this._chartPane.chartData().shapeStore().setInstanceOptions(t)}},{key:"removeShape",value:function(t){this._chartPane.chartData().shapeStore().removeInstance(t)}},{key:"createAnnotation",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kt;if(O(t)&&this._chartPane.hasPane(e)){var a=[].concat(t);this._chartPane.createAnnotation(a,e)}}},{key:"removeAnnotation",value:function(t,e){this._chartPane.chartData().annotationStore().remove(t,e)}},{key:"createTag",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:kt;if(O(t)&&this._chartPane.hasPane(e)){var a=[].concat(t);this._chartPane.createTag(a,e)}}},{key:"removeTag",value:function(t,e){this._chartPane.chartData().tagStore().remove(t,e)}},{key:"setPaneOptions",value:function(t){O(t)&&this._chartPane.setPaneOptions(t,!1)}},{key:"setZoomEnabled",value:function(t){this._chartPane.chartData().timeScaleStore().setZoomEnabled(t)}},{key:"isZoomEnabled",value:function(){return this._chartPane.chartData().timeScaleStore().zoomEnabled()}},{key:"setScrollEnabled",value:function(t){this._chartPane.chartData().timeScaleStore().setScrollEnabled(t)}},{key:"isScrollEnabled",value:function(){return this._chartPane.chartData().timeScaleStore().scrollEnabled()}},{key:"scrollByDistance",value:function(t,e){var a=this;if(R(t))if(R(e)&&e>0){this._chartPane.chartData().timeScaleStore().startScroll();var i=(new Date).getTime();!function n(){var r=((new Date).getTime()-i)/e,s=r>=1,o=s?t:t*r;a._chartPane.chartData().timeScaleStore().scroll(o),s||we(n)}()}else this._chartPane.chartData().timeScaleStore().startScroll(),this._chartPane.chartData().timeScaleStore().scroll(t)}},{key:"scrollToRealTime",value:function(t){var e=(this._chartPane.chartData().timeScaleStore().offsetRightBarCount()-this._chartPane.chartData().timeScaleStore().offsetRightSpace()/this._chartPane.chartData().timeScaleStore().dataSpace())*this._chartPane.chartData().timeScaleStore().dataSpace();this.scrollByDistance(e,t)}},{key:"scrollToDataIndex",value:function(t,e){if(R(t)){var a=(this._chartPane.chartData().dataList().length-1-t)*this._chartPane.chartData().timeScaleStore().dataSpace();this.scrollByDistance(a,e)}}},{key:"zoomAtCoordinate",value:function(t,e,a){var i=this;if(R(t))if(R(a)&&a>0){var n=this._chartPane.chartData().timeScaleStore().dataSpace(),r=n*t-n,s=(new Date).getTime();!function t(){var o=((new Date).getTime()-s)/a,c=o>=1,h=c?r:r*o;i._chartPane.chartData().timeScaleStore().zoom(h/n,e),c||we(t)}()}else this._chartPane.chartData().timeScaleStore().zoom(t,e)}},{key:"zoomAtDataIndex",value:function(t,e,a){if(R(t)&&R(e)){var i=this._chartPane.chartData().timeScaleStore().dataIndexToCoordinate(e);this.zoomAtCoordinate(t,{x:i},a)}}},{key:"convertToPixel",value:function(t,e){return this._chartPane.convertToPixel(t,e)}},{key:"convertFromPixel",value:function(t,e){return this._chartPane.convertFromPixel(t,e)}},{key:"subscribeAction",value:function(t,e){this._chartPane.chartData().actionStore().subscribe(t,e)}},{key:"unsubscribeAction",value:function(t,e){this._chartPane.chartData().actionStore().unsubscribe(t,e)}},{key:"getConvertPictureUrl",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"jpeg",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"#FFFFFF";if("png"===e||"jpeg"===e||"bmp"===e)return this._chartPane.getConvertPictureUrl(t,e,a)}},{key:"destroy",value:function(){this._chartPane.destroy()}}]),t}(),Da={},wa=1,ba="k_line_chart_";_.addTechnicalIndicatorTemplate([{name:"AVP",series:"price",precision:2,plots:[{key:"avp",title:"AVP: ",type:"line"}],calcTechnicalIndicator:function(t){var e=0,a=0;return t.map((function(t){var i={};return e+=t.turnover||0,0!==(a+=t.volume||0)&&(i.avp=e/a),i}))}},e,a,i,{name:"EMV",calcParams:[14,9],plots:[{key:"emv",title:"EMV: ",type:"line"},{key:"maEmv",title:"MAEMV: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a=e.params,i=0,n=0,r=[],s=[];return t.forEach((function(e,o){var c={},h=t[o-1]||e,l=e.high,u=e.low,d=e.turnover||0,v=0;0!==d&&(v=((l+u)/2-(h.high+h.low)/2)*(l-u)/d),r.push(v),i+=v,a[0]-1>o||(c.emv=i,i-=r[o-(a[0]-1)],n+=c.emv,a[0]+a[1]-2>o||(c.maEmv=n/a[1],n-=s[o-(a[1]-1)].emv)),s.push(c)})),s}},{name:"EMA",series:"price",calcParams:[6,12,20],precision:2,shouldCheckParamCount:!1,shouldOhlc:!0,plots:[{key:"ema6",title:"EMA6: ",type:"line"},{key:"ema12",title:"EMA12: ",type:"line"},{key:"ema20",title:"EMA20: ",type:"line"}],regeneratePlots:function(t){return t.map((function(t){return{key:"ema".concat(t),title:"EMA".concat(t,": "),type:"line"}}))},calcTechnicalIndicator:function(t,e){var a=e.params,i=e.plots,n=0,r=[];return t.map((function(t,e){var s={},o=t.close;return n+=o,a.forEach((function(t,a){t-1>e||(r[a]=e>t-1?(2*o+(t-1)*r[a])/(t+1):n/t,s[i[a].key]=r[a])})),s}))}},{name:"MA",series:"price",calcParams:[5,10,30,60],precision:2,shouldCheckParamCount:!1,shouldOhlc:!0,plots:[{key:"ma5",title:"MA5: ",type:"line"},{key:"ma10",title:"MA10: ",type:"line"},{key:"ma30",title:"MA30: ",type:"line"},{key:"ma60",title:"MA60: ",type:"line"}],regeneratePlots:function(t){return t.map((function(t){return{key:"ma".concat(t),title:"MA".concat(t,": "),type:"line"}}))},calcTechnicalIndicator:function(t,e){var a=e.params,i=e.plots,n=[];return t.map((function(e,r){var s={},o=e.close;return a.forEach((function(e,a){n[a]=(n[a]||0)+o,e-1>r||(s[i[a].key]=n[a]/e,n[a]-=t[r-(e-1)].close)})),s}))}},n,{name:"SMA",series:"price",calcParams:[12,2],precision:2,plots:[{key:"sma",title:"SMA: ",type:"line"}],shouldCheckParamCount:!0,shouldOhlc:!0,calcTechnicalIndicator:function(t,e){var a=e.params,i=0,n=0;return t.map((function(t,e){var r={},s=t.close;return i+=s,a[0]-1>e||(r.sma=n=e>a[0]-1?(s*a[1]+n*(a[0]-a[1]+1))/(a[0]+1):i/a[0]),r}))}},{name:"TRIX",calcParams:[12,9],plots:[{key:"trix",title:"TRIX: ",type:"line"},{key:"maTrix",title:"MATRIX: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a,i,n,r=e.params,s=0,o=0,c=0,h=0,l=[];return t.forEach((function(t,e){var u={},d=t.close;if(s+=d,e>=r[0]-1&&(o+=a=e>r[0]-1?(2*d+(r[0]-1)*a)/(r[0]+1):s/r[0],e>=2*r[0]-2&&(c+=i=e>2*r[0]-2?(2*a+(r[0]-1)*i)/(r[0]+1):o/r[0],e>=3*r[0]-3))){var v,_=0;e>3*r[0]-3?_=((v=(2*i+(r[0]-1)*n)/(r[0]+1))-n)/n*100:v=c/r[0],n=v,u.trix=_,h+=_,3*r[0]+r[1]-4>e||(u.maTrix=h/r[1],h-=l[e-(r[1]-1)].trix)}l.push(u)})),l}},{name:"BRAR",calcParams:[26],plots:[{key:"br",title:"BR: ",type:"line"},{key:"ar",title:"AR: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a=e.params,i=0,n=0,r=0,s=0;return t.map((function(e,o){var c={},h=e.high,l=e.low,u=e.open,d=(t[o-1]||e).close;if(r+=h-u,s+=u-l,i+=h-d,n+=d-l,o>=a[0]-1){c.ar=0!==s?r/s*100:0,c.br=0!==n?i/n*100:0;var v=t[o-(a[0]-1)],_=v.high,f=v.low,p=v.open,m=(t[o-a[0]]||t[o-(a[0]-1)]).close;i-=_-m,n-=m-f,r-=_-p,s-=p-f}return c}))}},r,{name:"MTM",calcParams:[12,6],plots:[{key:"mtm",title:"MTM: ",type:"line"},{key:"maMtm",title:"MAMTM: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a=e.params,i=0,n=[];return t.forEach((function(e,r){var s={};r<a[0]||(s.mtm=e.close-t[r-a[0]].close,i+=s.mtm,a[0]+a[1]-1>r||(s.maMtm=i/a[1],i-=n[r-(a[1]-1)].mtm));n.push(s)})),n}},{name:"PSY",calcParams:[12,6],plots:[{key:"psy",title:"PSY: ",type:"line"},{key:"maPsy",title:"MAPSY: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a=e.params,i=0,n=0,r=[],s=[];return t.forEach((function(e,o){var c={},h=e.close-(t[o-1]||e).close>0?1:0;r.push(h),i+=h,a[0]-1>o||(c.psy=i/a[0]*100,n+=c.psy,a[0]+a[1]-2>o||(c.maPsy=n/a[1],n-=s[o-(a[1]-1)].psy),i-=r[o-(a[0]-1)]),s.push(c)})),s}},{name:"ROC",calcParams:[12,6],shouldCheckParamCount:!0,plots:[{key:"roc",title:"ROC: ",type:"line"},{key:"maRoc",title:"MAROC: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a=e.params,i=[],n=0;return t.forEach((function(e,r){var s={};if(r>=a[0]-1){var o=(t[r-a[0]]||t[r-(a[0]-1)]).close;s.roc=0!==o?(e.close-o)/o*100:0,n+=s.roc,a[0]-1+a[1]-1>r||(s.maRoc=n/a[1],n-=i[r-(a[1]-1)].roc)}i.push(s)})),i}},{name:"VR",calcParams:[26,6],plots:[{key:"vr",title:"VR: ",type:"line"},{key:"maVr",title:"MAVR: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a=e.params,i=0,n=0,r=0,s=0,o=[];return t.forEach((function(e,c){var h={},l=e.close,u=(t[c-1]||e).close,d=e.volume;if(l>u?i+=d:u>l?n+=d:r+=d,c>=a[0]-1){var v=r/2;h.vr=n+v===0?0:(i+v)/(n+v)*100,s+=h.vr,a[0]+a[1]-2>c||(h.maVr=s/a[1],s-=o[c-(a[1]-1)].vr);var _=t[c-(a[0]-1)],f=t[c-a[0]]||_,p=_.close,m=_.volume;p>f.close?i-=m:f.close>p?n-=m:r-=m}o.push(h)})),o}},s,{name:"BIAS",calcParams:[6,12,24],shouldCheckParamCount:!1,plots:[{key:"bias6",title:"BIAS6: ",type:"line"},{key:"bias12",title:"BIAS12: ",type:"line"},{key:"bias24",title:"BIAS24: ",type:"line"}],regeneratePlots:function(t){return t.map((function(t){return{key:"bias".concat(t),title:"BIAS".concat(t,": "),type:"line"}}))},calcTechnicalIndicator:function(t,e){var a=e.params,i=e.plots,n=[];return t.map((function(e,r){var s={},o=e.close;return a.forEach((function(e,c){if(n[c]=(n[c]||0)+o,r>=e-1){var h=n[c]/a[c];s[i[c].key]=(o-h)/h*100,n[c]-=t[r-(e-1)].close}})),s}))}},o,c,l,u,d,v,{name:"OBV",calcParams:[30],plots:[{key:"obv",title:"OBV: ",type:"line"},{key:"maObv",title:"MAOBV: ",type:"line"}],calcTechnicalIndicator:function(t,e){var a=e.params,i=0,n=0,r=[];return t.forEach((function(e,s){var o=t[s-1]||e;o.close>e.close?n-=e.volume:e.close>o.close&&(n+=e.volume);var c={obv:n};i+=n,a[0]-1>s||(c.maObv=i/a[0],i-=r[s-(a[0]-1)].obv),r.push(c)})),r}},{name:"PVT",plots:[{key:"pvt",title:"PVT: ",type:"line"}],calcTechnicalIndicator:function(t){var e=0;return t.map((function(a,i){var n={},r=(t[i-1]||a).close,s=0;return 0!==r&&(s=(a.close-r)/r*a.volume),n.pvt=e+=s,n}))}},{name:"VOL",series:"volume",calcParams:[5,10,20],shouldCheckParamCount:!1,shouldFormatBigNumber:!0,precision:0,minValue:0,plots:[{key:"ma5",title:"MA5: ",type:"line"},{key:"ma10",title:"MA10: ",type:"line"},{key:"ma20",title:"MA20: ",type:"line"},{key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,color:function(t,e){var a=t.current.kLineData||{};return a.close>a.open?e.bar.upColor:a.open>a.close?e.bar.downColor:e.bar.noChangeColor}}],regeneratePlots:function(t){var e=t.map((function(t){return{key:"ma".concat(t),title:"MA".concat(t,": "),type:"line"}}));return e.push({key:"volume",title:"VOLUME: ",type:"bar",baseValue:0,color:function(t,e){var a=t.current.kLineData||{};return a.close>a.open?e.bar.upColor:a.open>a.close?e.bar.downColor:e.bar.noChangeColor}}),e},calcTechnicalIndicator:function(t,e){var a=e.params,i=e.plots,n=[];return t.map((function(e,r){var s=e.volume||0,o={volume:s};return a.forEach((function(e,a){n[a]=(n[a]||0)+s,e-1>r||(o[i[a].key]=n[a]/e,n[a]-=t[r-(e-1)].volume)})),o}))}}]),_.addShapeTemplate([{name:"horizontalRayLine",totalStep:3,checkEventCoordinateOnShape:function(t){var e=t.dataSource;return Wt(e[0],e[1],t.eventCoordinate)},createShapeDataSource:function(t){var e=t.coordinates,a={x:0,y:e[0].y};return e[1]&&e[1].x>e[0].x&&(a.x=t.viewport.width),[{type:"line",isDraw:!0,isCheck:!0,dataSource:[[e[0],a]]}]},performEventPressedMove:function(t){var e=t.points,a=t.pressPoint;e[0].value=a.value,e[1].value=a.value},performEventMoveForDrawing:function(t){2===t.step&&(t.points[0].value=t.movePoint.value)}},{name:"horizontalSegment",totalStep:3,checkEventCoordinateOnShape:function(t){var e=t.dataSource;return Nt(e[0],e[1],t.eventCoordinate)},createShapeDataSource:function(t){var e=t.coordinates,a=[];return 2===e.length&&(a=[e]),[{type:"line",isDraw:!0,isCheck:!0,dataSource:a}]},performEventPressedMove:function(t){var e=t.points,a=t.pressPoint;e[0].value=a.value,e[1].value=a.value},performEventMoveForDrawing:function(t){2===t.step&&(t.points[0].value=t.movePoint.value)}},{name:"horizontalStraightLine",totalStep:2,checkEventCoordinateOnShape:function(t){var e=t.dataSource;return Yt(e[0],e[1],t.eventCoordinate)},createShapeDataSource:function(t){var e=t.coordinates;return[{type:"line",isDraw:!0,isCheck:!0,dataSource:[[{x:0,y:e[0].y},{x:t.viewport.width,y:e[0].y}]]}]}},{name:"verticalRayLine",totalStep:3,checkEventCoordinateOnShape:function(t){var e=t.dataSource;return Wt(e[0],e[1],t.eventCoordinate)},createShapeDataSource:function(t){var e=t.coordinates,a={x:e[0].x,y:0};return e[1]&&e[1].y>e[0].y&&(a.y=t.viewport.height),[{type:"line",isDraw:!0,isCheck:!0,dataSource:[[e[0],a]]}]},performEventPressedMove:function(t){var e=t.points,a=t.pressPoint;e[0].timestamp=a.timestamp,e[0].dataIndex=a.dataIndex,e[1].timestamp=a.timestamp,e[1].dataIndex=a.dataIndex},performEventMoveForDrawing:function(t){var e=t.points,a=t.movePoint;2===t.step&&(e[0].timestamp=a.timestamp,e[0].dataIndex=a.dataIndex)}},{name:"verticalSegment",totalStep:3,checkEventCoordinateOnShape:function(t){var e=t.dataSource;return Nt(e[0],e[1],t.eventCoordinate)},createShapeDataSource:function(t){var e=t.coordinates,a=[];return 2===e.length&&(a=[e]),[{type:"line",isDraw:!0,isCheck:!0,dataSource:a}]},performEventPressedMove:function(t){var e=t.points,a=t.pressPoint;e[0].timestamp=a.timestamp,e[0].dataIndex=a.dataIndex,e[1].timestamp=a.timestamp,e[1].dataIndex=a.dataIndex},performEventMoveForDrawing:function(t){var e=t.points,a=t.movePoint;2===t.step&&(e[0].timestamp=a.timestamp,e[0].dataIndex=a.dataIndex)}},{name:"verticalStraightLine",totalStep:2,checkEventCoordinateOnShape:function(t){var e=t.dataSource;return Yt(e[0],e[1],t.eventCoordinate)},createShapeDataSource:function(t){var e=t.coordinates;return[{type:"line",isDraw:!0,isCheck:!0,dataSource:[[{x:e[0].x,y:0},{x:e[0].x,y:t.viewport.height}]]}]}},{name:"rayLine",totalStep:3,checkEventCoordinateOnShape:function(t){var e=t.dataSource;return Wt(e[0],e[1],t.eventCoordinate)},createShapeDataSource:function(t){var e,a,i,n=t.coordinates,r=t.viewport;return[{type:"line",isDraw:!0,isCheck:!0,dataSource:[(e=n[0],a=n[1],i={x:r.width,y:r.height},e&&a?[e,e.x===a.x&&e.y!==a.y?a.y>e.y?{x:e.x,y:i.y}:{x:e.x,y:0}:e.x>a.x?{x:0,y:Vt(e,a,{x:0,y:e.y})}:{x:i.x,y:Vt(e,a,{x:i.x,y:e.y})}]:[])]}]}},{name:"segment",totalStep:3,checkEventCoordinateOnShape:function(t){var e=t.dataSource;return Nt(e[0],e[1],t.eventCoordinate)},createShapeDataSource:function(t){var e=t.coordinates,a=[];return 2===e.length&&(a=[e]),[{type:"line",isDraw:!0,isCheck:!0,dataSource:a}]}},{name:"straightLine",totalStep:3,checkEventCoordinateOnShape:function(t){var e=t.dataSource;return Yt(e[0],e[1],t.eventCoordinate)},createShapeDataSource:function(t){var e=t.coordinates,a=t.viewport;return 2>e.length||e[0].x===e[1].x?[{type:"line",isDraw:!0,isCheck:!0,dataSource:[[{x:e[0].x,y:0},{x:e[0].x,y:a.height}]]}]:[{type:"line",isDraw:!0,isCheck:!0,dataSource:[[{x:0,y:Vt(e[0],e[1],{x:0,y:e[0].y})},{x:a.width,y:Vt(e[0],e[1],{x:a.width,y:e[0].y})}]]}]}},{name:"parallelStraightLine",totalStep:4,checkEventCoordinateOnShape:function(t){var e=t.dataSource;return Yt(e[0],e[1],t.eventCoordinate)},createShapeDataSource:function(t){var e=t.viewport;return[{type:"line",isDraw:!0,isCheck:!0,dataSource:Xt(t.coordinates,{x:e.width,y:e.height})}]}},{name:"priceChannelLine",totalStep:4,checkEventCoordinateOnShape:function(t){var e=t.dataSource;return Yt(e[0],e[1],t.eventCoordinate)},createShapeDataSource:function(t){var e=t.viewport;return[{type:"line",isDraw:!0,isCheck:!0,dataSource:Xt(t.coordinates,{x:e.width,y:e.height},1)}]}},{name:"priceLine",totalStep:2,checkEventCoordinateOnShape:function(t){var e=t.dataSource;return Wt(e[0],e[1],t.eventCoordinate)},createShapeDataSource:function(t){var e=t.coordinates,a=t.precision;return[{type:"line",isDraw:!0,isCheck:!0,dataSource:[[e[0],{x:t.viewport.width,y:e[0].y}]]},{type:"text",isDraw:!0,isCheck:!1,dataSource:[{x:e[0].x,y:e[0].y,text:t.yAxis.convertFromPixel(e[0].y).toFixed(a.price)}]}]}},{name:"fibonacciLine",totalStep:3,checkEventCoordinateOnShape:function(t){var e=t.dataSource;return Yt(e[0],e[1],t.eventCoordinate)},createShapeDataSource:function(t){var e=t.points,a=t.coordinates,i=t.precision;if(a.length>0){var n=[],r=[],s=t.viewport.width;if(a.length>1){var o=a[0].y-a[1].y,c=e[0].value-e[1].value;[1,.786,.618,.5,.382,.236,0].forEach((function(t){var h=a[1].y+o*t,l=(e[1].value+c*t).toFixed(i.price);n.push([{x:0,y:h},{x:s,y:h}]),r.push({x:0,y:h,text:"".concat(l," (").concat((100*t).toFixed(1),"%)")})}))}return[{type:"line",isDraw:!0,isCheck:!0,dataSource:n},{type:"text",isDraw:!0,isCheck:!1,dataSource:r}]}return[]}}]),t.dispose=function(t){if(t){var e;if(B(t)){var a=document.getElementById(t);e=a&&a.chartId}else e=t instanceof Sa?t.id:t&&t.chartId;e&&(Da[e].destroy(),delete Da[e])}},t.extension=_,t.init=function(t){var e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)return null;if(!(e=B(t)?document.getElementById(t):t))return null;var i=Da[e.chartId||""];if(i)return i;var n="".concat(ba).concat(wa++);return(i=new Sa(e,a)).id=n,e.chartId=n,Da[n]=i,i},t.version=function(){return"8.0.0"},Object.defineProperty(t,"__esModule",{value:!0})}));
